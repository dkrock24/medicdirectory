{% extends "Layout/base_emr/_clients_base.html.twig" %}

{% block title_page %}
    EMR || Perfil médico
{% endblock %}

{% block breadcrumb %}
    {{ include('EmrBundle:perfil:_breadcrumb.html.twig' )  }}
{% endblock %} 

{% block submenutop %}
    {{ include('EmrBundle:perfil:_submenu.html.twig' )  }}
{% endblock %} 

{% block body %}
    <style>
        #change-password{
            display:none;
        }
        #table-social-network td{
            padding:6px !important;
        }
    </style>
    <link rel="stylesheet" href="{{ asset('bundles/admin/add-on/week/weekly.css') }}">
    <div class="row">
        <div class="col-lg-12">

            <!-- Check the notifications -->
            {% for message in app.session.flashbag().get("success") %}
                <div class="alert alert-success alert-styled-left alert-arrow-left alert-component"> {{message}}</div>
            {% endfor %}
            {% for message in app.session.flashbag().get("error") %}
                <div class="alert alert-danger"><i class="fa fa-close"></i> {{message}}</div>
            {% endfor %}
            <!-- End notifications -->
        </div>
    </div>
    <div class="page-header-content">
        <div class="page-title">
            <h4>
                <i class="fa fa-info-circle position-left"></i>
                <span class="text-semibold">Home</span> - Perfil médico

                <small class="display-block">Este perfil será mostrado en el sitio web</small></h4>
            <a class="heading-elements-toggle"><i class="icon-more"></i></a><a class="heading-elements-toggle"><i class="icon-more"></i></a></div>

        <div class="heading-elements">
            <div class="heading-btn-group">

                <a href="#" class="btn btn-link btn-float has-text"><i class="icon-bars-alt text-primary"></i><span>Statistics</span></a>
                <a href="#" class="btn btn-link btn-float has-text"><i class="icon-calculator text-primary"></i> <span>Invoices</span></a>
                <a href="#" class="btn btn-link btn-float has-text"><i class="icon-calendar5 text-primary"></i> <span>Schedule</span></a>

            </div>
        </div>

    </div>        
    <div class="row">
        <div class="col-lg-12">         
            {#
            {{ form_start(form) }}
                {{ form_widget(form) }}
                <button type="submit" class="btn btn-success"><i class="icon-newspaper"></i> Crear</button>
            {{ form_end(form) }}
            #}
            <div class="panel panel-white">
                
                
                <div class="panel-body">
                   
                    <div class="form_error"></div>
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs nav-tabs-highlight " role="tablist">
                        <li role="presentation" class="active"><a href="#personal_date" aria-controls="home" role="tab" data-toggle="tab"><i class="fa fa-list-alt"></i> Datos personales</a></li>
                        <li role="presentation"><a href="#address" aria-controls="profile" role="tab" data-toggle="tab"><i class="fa fa-address-book-o" aria-hidden="true"></i> Mi Perfil</a></li>
                        <!--<li role="presentation"><a href="#phones" aria-controls="messages" role="tab" data-toggle="tab"></a></li>-->
                        <li role="presentation"><a href="#picture" aria-controls="settings" role="tab" data-toggle="tab"><i class="fa fa-file-image-o"></i> Fotografía</a></li>
                    </ul>
                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="personal_date">
                            <fieldset>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="alert alert-info alert-styled-left alert-arrow-left alert-component">Datos personales</div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <div class="form_error"></div>
                                                    <label for="" class=" control-label">Primer Nombre:</label>
                                                    <div class=""><input type="text" class="form-control" value="{{ user.UsuNombre }}" id="nameone"></div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">    
                                                <div class="form-group">
                                                    <div class="form_error"></div>
                                                    <label for="" class=" control-label">Segundo Nombre:</label>
                                                    <div class=""><input type="text" class="form-control" value="{{ user.UsuSegundoNombre }}" id="nametwo"></div>
                                                </div>
                                            </div>

                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <div class="form_error"></div>
                                                    <label for="" class=" control-label">Tercer Nombre:</label>
                                                    <div class=""><input type="text" class="form-control" value="{{ user.UsuTercerNombre }}" id="namethree"></div>
                                                </div>
                                            </div>    
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <div class="form_error"></div>
                                                    <label for="" class=" control-label">Primer Apellido:</label>
                                                    <div class=""><input type="text" class="form-control" value="{{ user.UsuPrimerApellido }}" id="lastenameone"></div>
                                                </div>
                                            </div>

                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <div class="form_error"></div>
                                                    <label for="" class="control-label">Segundo Apellido:</label>
                                                    <div class=""><input type="text" class="form-control" value="{{ user.UsuSegundoApellido }}" id="lastnametwo"></div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <div class="form_error"></div>
                                                    <label for="" class="control-label">Fecha de Nacimiento:</label>
                                                    <div class=""><input type="text" class="form-control" value="{{ user.UsuFechaNacimiento|date('Y-m-d') }}" id="birthdate" readonly="readonly"></div>
                                                </div>
                                            </div>    
                                        </div>

                                        <div class="row">

                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <div class="form_error"></div>
                                                    <label for="" class=" control-label">Título:</label>
                                                    <div class="">
                                                        <select id="title" class="select">
                                                            <option value="Dr.">Dr.</option>
                                                            <option value="Dra.">Dra.</option>
                                                            <option value="Lcdo.">Lcdo.</option>
                                                            <option value="Lcda.">Lcda.</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>    

                                        </div>

                                    </div>
                                    <div class="col-lg-6">
                                         <div class="alert alert-info alert-styled-left alert-arrow-left alert-component">Mi Horario</div>
                                        <div id="scheduleWeekly"></div>
                                    </div>
                                </div>  
                                       
                            </fieldset>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="address">

                            <fieldset>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="alert alert-info alert-styled-left alert-arrow-left alert-component">Información de contacto</div>
                                        <div class="row">
                                            <div class="col-lg-12">
                                            <div class="panel panel-body border-top-primary">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="form-group">
                                                        <div class="form_error"></div>
                                                        <label for="" class=" control-label">Dirección:</label>
                                                        <div class=""><input type="text" class="form-control" id="addressUser" value="{{ user.UsuDireccion }}"></div>
                                                    </div>
                                                </div> 
                                            </div>
                                            <div class="row">
                                                <div class="p">
                                                    <div class="col-lg-6">
                                                        <div class="form-group">
                                                            <div class="form_error"></div>
                                                            <label for="" class=" control-label">Teléfono Establecimiento:</label>
                                                            <div class=""><input type="text" class="form-control" id="phone" value="{{ user.UsuTelefono }}"></div>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <div class="form-group">
                                                            <div class="form_error"></div>
                                                            <label for="" class=" control-label">Correo electronico:</label>
                                                            <div class=""><input type="text" class="form-control" id="email" value="{{ user.UsuCorreo }}"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="panel panel-body border-top-primary ">
                                                    <div class="form-horizontal">
                                                        <div class="form-group">
                                                          <label for="inputEmail3" class="col-sm-2 control-label">Sitio web:</label>
                                                          <div class="col-sm-10">
                                                            
                                                            <select class="form-control" id="social-network-list" class="select">
                                                                {% for social in socials %}
                                                                    <option value="{{ social.idSocRed }}">{{ social.SocRedNombre }}</option>
                                                                {% endfor %}
                                                            </select>
                                                          </div>
                                                        </div>
                                                        <div class="form-group">
                                                          <label for="inputPassword3" class="col-sm-2 control-label">Url:</label>
                                                          <div class="col-sm-10">
                                                            <input type="text" class="form-control" id="url" placeholder="Url">
                                                          </div>
                                                        </div>
                                                        <div class="form-group">
                                                          <div class="col-sm-offset-2 col-sm-10 ">
                                                            <button type="submit" class="btn btn-default" id="btn-add-social-network">Agregar</button>
                                                          </div>
                                                        </div>
                                                            <div id="socialList">
                                                                <div class="table-responsive">
                                                                    <table class="table table-striped" id="table-social-network">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Tipo</th>
                                                                                <th>Url</th>
                                                                                <th></th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            {% for network in networkSelected %}
                                                                                <tr id="{{ network.idSocialRed.idSocRed }}">
                                                                                    <td>{{ network.idSocialRed.socRedNombre }}</td>
                                                                                    <td>{{ network.usuSocUrl }}</td>
                                                                                    <td><button class="btn btn-danger btn-sm removeNetwork">x</button></td>
                                                                                </tr>
                                                                            {% endfor %}    

                                                                        </tbody> 
                                                                    </table>
                                                                </div>
                                                            </div>    
                                                      </div>
                                                </div>    
                                            </div>
                                        </div>                   
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="panel panel-body border-top-primary ">
                                                    <div class="form-horizontal">
                                                       
                                                        <div class="form-group">
                                                          
                                                          <div class="col-sm-12">
                                                              <label class="radio-inline">
                                                                Cambiar Contraseña?
                                                              </label>
                                                              <label class="radio-inline">
                                                                <input type="radio" name="radioPassword" id="" class="radioPassword" value="yes"> Si
                                                              </label>
                                                              <label class="radio-inline">
                                                                  <input type="radio" name="radioPassword" id="" class="radioPassword" value="no" checked="checked"> No
                                                              </label>
                                                          </div>
                                                        </div>
                                                        <div id="change-password">
                                                            <div class="form-group">
                                                                <label for="inputPassword3" class="col-sm-2 control-label">Contraseña</label>
                                                                <div class="col-sm-10">
                                                                  <input type="text" class="form-control" placeholder="Password" id="password">
                                                                </div>
                                                              </div>
                                                              <div class="form-group">
                                                                <label for="inputPassword3" class="col-sm-2 control-label">Repita Contraseña</label>
                                                                <div class="col-sm-10">
                                                                  <input type="text" class="form-control" placeholder="Repita Password" id="repeat_password">
                                                                </div>
                                                              </div>
                                                        </div>
                                                      </div>
                                                </div>    
                                            </div>
                                        </div>
                                                            
                                        
                                    </div>
                                    <div class="col-md-8">
                                        <div class="alert alert-info alert-styled-left alert-arrow-left alert-component">Experiencia Médica</div>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="panel panel-body border-top-primary ">
                                                    <div class="form-group">
                                                        <div class="form_error"></div>
                                                        <label for="" class=" control-label">Mis especialidades:</label>
                                                        <div class="">
                                                            <select id="specialitiesList" class="select" multiple>
                                                                {% for speciality in specialities %}
                                                                    {% if speciality.EspId in specialitiesSelected %}
                                                                        <option value="{{ speciality.EspId }}" selected="selected">{{ speciality.EspEspecialidad }}</option>
                                                                    {% else %}
                                                                        <option value="{{ speciality.EspId }}" >{{ speciality.EspEspecialidad }}</option>
                                                                    {% endif %}    
                                                                    
                                                                {% endfor %}
                                                                
                                                            </select>
                                                              
                                                        </div>
                                                    </div>
                                                </div>
                                            </div> 
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="panel panel-body border-top-primary">
                                                    <div class="form-group">
                                                        <label for="" class=" control-label">Estudios/Experiencia Laboral/Cargos/Congreso/Etc</label>
                                                        <div class="">
                                                            <textarea cols="18" rows="18" id="profile_info" class="wysihtml5 wysihtml5-default form-control" placeholder="Describa su perfil..." style="height: 500px">
                                                                {{ user.UsuInfoPerfil }}
                                                            </textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>       
                                </div>
       
                            </fieldset>

                        </div>
                        <div role="tabpanel" class="tab-pane" id="picture">
                            <fieldset>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            
                                            <!-- Nav tabs -->
                                            <ul class="nav nav-tabs" role="tablistUpload">
                                              <li role="presentation" class="active"><a href="#pc" aria-controls="pc" role="tab" data-toggle="tab"><i class='fa fa-upload'></i> PC</a></li>
                                              <li role="presentation"><a href="#webcam" aria-controls="webcam" role="tab" data-toggle="tab"><i class='fa fa-camera'></i> Carama web</a></li>
                                            </ul>
                                            <!-- Tab panes -->
                                            <div class="tab-content">
                                                <div role="tabpanel" class="tab-pane active" id="pc">
                                                    <div class="alert alert-info alert-styled-left alert-arrow-left alert-component">
                                                        Seleccione una opción:  &nbsp; &nbsp;
                                                        {% for type in imageType %}
                                                            <label class="radio-inline">
                                                                <input type="radio" name="radioTypeImage" id="" value="{{ type.usuGalTipId }}" class="docs-toggles" > {{ type.usuGalTipNombre }}
                                                            </label>
                                                        {% endfor %}    
                                                    </div>
                                                    {{ include('EmrBundle:perfil:_cropper.html.twig' )  }} 
                                                    
                                                </div>
                                                <div role="tabpanel" class="tab-pane" id="webcam">
                                                    {{ include('EmrBundle:paciente:_webcam.html.twig' )  }}
                                                </div>
                                            </div>
                                            
                                            
                                        </div>
                                    </div>   
                                </div>
                                          
                            </fieldset>
                            
                        </div>
                    

                    

                        <hr>
                        <ul class="list-inline">
                            <li>
                                <button type="button" class="btn btn-primary btn-sm" id="btn-save-form">
                                    <span class="docs-tooltip" data-toggle="tooltip" data-animation="false" title="">
                                        Enviar datos
                                    </span>
                                </button>
                            </li>
                            <li>
                                <a href="" class="btn btn-info btn-sm"><i class="fa fa-list"></i> Ver como me ven</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </div>
                                              
    <script type="text/javascript" src="{{ asset('bundles/admin/add-on/week/jquery.weekly.js') }}"></script>
    {% endblock %}

    {% block codejs %}
        <script>
            $(document).on("ready", function () {
                
                

            {# {{ include('EmrBundle:paciente:_cropper.js.html.twig' )  }} #}
                    
                    var img_base64 = "";
                    
                    'use strict';
                    
                    var console = window.console || {log: function () {}};
                    var URL = window.URL || window.webkitURL;
                    var $image = $('#image');
                    var $download = $('#download');
                    var $dataX = $('#dataX');
                    var $dataY = $('#dataY');
                    var $dataHeight = $('#dataHeight');
                    var $dataWidth = $('#dataWidth');
                    var $dataRotate = $('#dataRotate');
                    var $dataScaleX = $('#dataScaleX');
                    var $dataScaleY = $('#dataScaleY');
                    var options = {
                        aspectRatio: 1 / 1,
                        preview: '.img-preview',
                        crop: function (e) {
                            $dataX.val(Math.round(e.x));
                            $dataY.val(Math.round(e.y));
                            $dataHeight.val(Math.round(e.height));
                            $dataWidth.val(Math.round(e.width));
                            $dataRotate.val(e.rotate);
                            $dataScaleX.val(e.scaleX);
                            $dataScaleY.val(e.scaleY);
                        },
                        cropBoxResizable: false,
                        //setDragMode:false,
                        
                    };
                    var originalImageURL = $image.attr('src');
                    var uploadedImageURL;


                    // Tooltip
                    $('[data-toggle="tooltip"]').tooltip();


                    // Cropper
                    $image.on({
                        ready: function (e) {
                            console.log(e.type);
                        },
                        cropstart: function (e) {
                            console.log(e.type, e.action);
                        },
                        cropmove: function (e) {
                            console.log(e.type, e.action);
                            
                        },
                        cropend: function (e) {
                            console.log(e.type, e.action);
                        },
                        crop: function (e) {
                            console.log(e.type, e.x, e.y, e.width, e.height, e.rotate, e.scaleX, e.scaleY);
                        },
                        zoom: function (e) {
                            console.log(e.type, e.ratio);
                        }
                    }).cropper(options);


                    // Buttons
                    if (!$.isFunction(document.createElement('canvas').getContext)) {
                        $('button[data-method="getCroppedCanvas"]').prop('disabled', true);
                        //$('button[data-method="getCroppedCanvasX"]').prop('disabled', true);
                    }

                    if (typeof document.createElement('cropper').style.transition === 'undefined') {
                        $('button[data-method="rotate"]').prop('disabled', true);
                        $('button[data-method="scale"]').prop('disabled', true);
                    }


                    // Download
                    if ($("#download").size() > 0) {
                        if (typeof $download[0].download === 'undefined') {
                            $download.addClass('disabled');
                        }
                    }


                    // Options
                    $('.docs-toggles').on('change', 'input', function () {
                        var $this = $(this);
                        var name = $this.attr('name');
                        var type = $this.prop('type');
                        var cropBoxData;
                        var canvasData;

                        if (!$image.data('cropper')) {
                            return;
                        }

                        if (type === 'checkbox') {
                            options[name] = $this.prop('checked');
                            cropBoxData = $image.cropper('getCropBoxData');
                            canvasData = $image.cropper('getCanvasData');

                            options.ready = function () {
                                $image.cropper('setCropBoxData', cropBoxData);
                                $image.cropper('setCanvasData', canvasData);
                                
                                console.log("aqui");
                            };
                            
                            console.log("aqui");
                        } else if (type === 'radio') {
                            options[name] = $this.val();
                            
                            console.log("alla");
                        }

                        $image.cropper('destroy').cropper(options);
                    });


                    // Methods
                    $('body').on('click', '[data-method]', function () {
                        var $this = $(this);
                        var data = $this.data();
                        var $target;
                        var result;

                        if ($this.prop('disabled') || $this.hasClass('disabled')) {
                            return;
                        }

                        if ($image.data('cropper') && data.method) {
                            data = $.extend({}, data); // Clone a new one

                            if (typeof data.target !== 'undefined') {
                                $target = $(data.target);

                                if (typeof data.option === 'undefined') {
                                    try {
                                        data.option = JSON.parse($target.val());
                                    } catch (e) {
                                        console.log(e.message);
                                    }
                                }
                            }

                            if (data.method === 'rotate') {
                                $image.cropper('clear');
                            }

                            result = $image.cropper(data.method, data.option, data.secondOption);

                            if (data.method === 'rotate') {
                                $image.cropper('crop');
                            }

                            switch (data.method) {
                                case 'scaleX':
                                case 'scaleY':
                                    $(this).data('option', -data.option);
                                    break;

                                case 'getCroppedCanvas':
                                    if (result) {

                                        // Bootstrap's Modal
                                        $('#getCroppedCanvasModal').modal().find('.modal-body').html(result);

                                        if (!$download.hasClass('disabled')) {
                                            $download.attr('href', result.toDataURL('image/png'));
                                        }
                                        
                                        img_base64 = result.toDataURL('image/png');
                                    }
                                    //console.log(result.toDataURL('image/jpeg'));
                                    break;
  
                                case 'destroy':
                                    if (uploadedImageURL) {
                                        URL.revokeObjectURL(uploadedImageURL);
                                        uploadedImageURL = '';
                                        $image.attr('src', originalImageURL);
                                    }

                                    break;
                            }

                            if ($.isPlainObject(result) && $target) {
                                try {
                                    $target.val(JSON.stringify(result));
                                } catch (e) {
                                    console.log(e.message);
                                }
                            }

                        }
                    });


                    // Keyboard
                    $(document.body).on('keydown', function (e) {

                        if (!$image.data('cropper') || this.scrollTop > 300) {
                            return;
                        }

                        switch (e.which) {
                            case 37:
                                e.preventDefault();
                                $image.cropper('move', -1, 0);
                                break;

                            case 38:
                                e.preventDefault();
                                $image.cropper('move', 0, -1);
                                break;

                            case 39:
                                e.preventDefault();
                                $image.cropper('move', 1, 0);
                                break;

                            case 40:
                                e.preventDefault();
                                $image.cropper('move', 0, 1);
                                break;
                        }

                    });


                    // Import image
                    var $inputImage = $('#inputImage');

                    if (URL) {
                        $inputImage.change(function () {
                            var files = this.files;
                            var file;

                            if (!$image.data('cropper')) {
                                return;
                            }

                            if (files && files.length) {
                                file = files[0];

                                if (/^image\/\w+$/.test(file.type)) {
                                    if (uploadedImageURL) {
                                        URL.revokeObjectURL(uploadedImageURL);
                                    }

                                    uploadedImageURL = URL.createObjectURL(file);
                                    $image.cropper('destroy').attr('src', uploadedImageURL).cropper(options);
                                    $inputImage.val('');
                                } else {
                                    window.alert('Porfavor seleccione una imagen.');
                                }
                            }
                        });
                    } else {
                        $inputImage.prop('disabled', true).parent().addClass('disabled');
                    }






                    $("#btn-save-form").on("click", function () {
                        saveFormAjax();
                    });


                    // Initialize plugins
                    // ------------------------------

                    // Select2 selects
                    $('.select').select2();

                    function getLocationsAjax(id) {
                        $("#holder_loading").show();
						$.ajax({
                            type: "post",
                            url: "{{ path('emr_location_per_country') }}",
                            data: {id: id},
                            error: function (data) {
                                $("#holder_loading").hide();
                                $.confirm({
                                    icon: 'fa fa-remove',
                                    title: 'Error!',
                                    content: 'Ha ocurrido un error al tratar de enviar la petición',
                                    type: 'red',
                                    typeAnimated: true,
                                    buttons: {
                                        tryAgain: {
                                            text: 'Intentar de nuevo',
                                            btnClass: 'btn-red',
                                            action: function () {
                                                getLocationsAjax(id);
                                            }
                                        },
                                        close: function () {
                                        }
                                    }
                                });

                            },
                            success: function (data) {
                                $("#holder_loading").hide();

                                //console.log(data.length);


                                if (data.length > 1)
                                {
                                    /*
                                     $.alert({
                                     icon: 'fa fa-check-circle',
                                     title: 'Ok!',
                                     content: 'El registro fue eliminado con éxito',
                                     type: 'green',
                                     typeAnimated: true,
                                     });
                                     */
                                    $("#appbundle_paciente_pacMun").empty();
                                    for (i = 0; i < data.length; i++)
                                    {
                                        //console.log(data[i]['mun_nombre']);
                                        $("#appbundle_paciente_pacMun").append($('<option>', {value: data[i]['mun_id'], text: data[i]['mun_nombre'] + " / " + data[i]['dep_departamento']}));
                                    }
                                    //$("#appbundle_paciente_pacMun").append($('<option>', {value: 100000, text: 'new option'}));
                                } else
                                {
                                    var infoError = (data);
                                    $.alert({
                                        icon: 'glyphicon glyphicon-exclamation-sign',
                                        title: 'Info!',
                                        content: 'No hay información asociada al pais seleccionado <br>' + infoError,
                                        type: 'red',
                                        typeAnimated: true,
                                    });
                                }

                            }
                        });
                    }
                    
                    
                    function saveFormAjax() {
                        
                        //alert();
                        var address = $("#addressUser").val();
                        var phone = $("#phone").val();
                        var email = $("#email").val();
                        var password = $("#password").val();
                        var repeat_password = $("#repeat_password").val();
                        var specialitiesList = $("#specialitiesList").val();
                        var title = $("#title").val();
                        
                        if( password != repeat_password)
                        {
                            $.alert({
                                icon: 'glyphicon glyphicon-exclamation-sign',
                                title: 'Info!',
                                content: 'Las contraseñas no son iguales',
                                type: 'blue',
                                typeAnimated: true,
                            });
                            return false;
                        }
                        
                        var specialitiesList = []; 
                        $('#specialitiesList :selected').each(function(i, selected){ 
                          specialitiesList[i] = $(selected).val(); 
                        });
                        /*
                        var day = [];
                        $(".days:checked").each(function(){
                             var opt = $(this).val();
                             day.push(opt);
                        });
                        */
                        var social_network = [];
                        $("#table-social-network tbody tr").each(function(){
                            var trId = $(this).attr("id");
                            var txt = $("#"+trId).find("td").eq(1).text();
                            var td = {"id":trId, "url":txt};
                            social_network.push(td);
                        });
                        
                        //=====================================
                        //Schedule
                        //=====================================
                        var schedule = {};
                        $(".weekly_day_label").each(function(){
                            var day = $(this).data("weeklyday");
                            var hoursList = [];
                            $("."+day).each(function(){
                                if( $(this).hasClass("active") )
                                {
                                    var hour = $(this).closest(".weekly_column_hour").data("weeklyhour");
                                    hoursList.push(hour);
                                }
                            });
                            schedule[day] = hoursList;
                        });
                        
                        //console.log(schedule);
                        //======================================
                        //End schedule
                        //======================================
                        
                        //console.log(JSON.stringify(social_network));
                        //return false;
                        var profile = $("#profile_info").val();
                        var img = img_base64;
                             
                        var routeShow = "{{ path('perfil_form') }}"
                        $("#holder_loading").show();
						$.ajax({
                            type: "post",
                            url: routeShow,
                            data: {
                                address: address,phone: phone,
                                specialitiesList:specialitiesList,
                                email: email, password: password,title:title,
                                schedule: schedule,
                                social_network: (social_network), 
                                profile:profile,
                                img: img
                            },
                            error: function (data) {
                                $("#holder_loading").hide();
                                $.confirm({
                                    icon: 'fa fa-remove',
                                    title: 'Error!',
                                    content: 'Ha ocurrido un error al tratar de enviar la petición',
                                    type: 'red',
                                    typeAnimated: true,
                                    buttons: {
                                        tryAgain: {
                                            text: 'Intentar de nuevo',
                                            btnClass: 'btn-red',
                                            action: function () {
                                                saveFormAjax();
                                            }
                                        },
                                        close: function () {
                                        }
                                    }
                                });

                            },
                            success: function (data) {
                                

                                //console.log(data.length);


                                if (data > 0)
                                {
                                    
                                    //$('form[name$=appbundle_paciente]')[0].reset();
                                    
                                     
                                    var routeShow = "{{ path('perfil_show') }}" //routeShow.replace("PLACEHOLDER", data);
                                    window.location.assign(routeShow);
                                    //$("#holder_loading").hide();
                                    
                                    
                                     
                                     $("body").find(".cropper-container").remove();
                                     $(".img-preview").empty();
                                     $(".currentPicture").html("<img src='"+img+"' class='img-thumbnail'>");
                                     
                                    //$("#appbundle_paciente_pacMun").append($('<option>', {value: 100000, text: 'new option'}));
                                } else 
                                {
                                    $("#holder_loading").hide();
                                    var infoError = (data);
                                    $.alert({
                                        icon: 'glyphicon glyphicon-exclamation-sign',
                                        title: 'Info!',
                                        content: 'Ocurrio un error al intentar guardar la información <br>' + infoError,
                                        type: 'blue',
                                        typeAnimated: true,
                                    });
                                }
                                
                                

                            }
                        });
                    }
                    
                    function searchPatients()
                    {
                        var search = $("#input_search_patients").val();
                        if( $.trim(search) == "" )
                        {
                            //var infoError = (data);
                            $.alert({
                                icon: 'glyphicon glyphicon-exclamation-sign',
                                title: 'Info!',
                                content: 'El campo de la búsqueda no puede estar vacio',
                                type: 'blue',
                                typeAnimated: true,
                            });
                            return false;
                        }
                        $("#holder_loading").show();
                            $.ajax({
                                type: "post",
                                url: "{{ path('paciente_search') }}",
                                data: { search: search },
                                error: function (data) {
                                    $("#holder_loading").hide();
                                    $.confirm({
                                        icon: 'fa fa-remove',
                                        title: 'Error!',
                                        content: 'Ha ocurrido un error al tratar de enviar la petición',
                                        type: 'red',
                                        typeAnimated: true,
                                        buttons: {
                                            tryAgain: {
                                                text: 'Intentar de nuevo',
                                                btnClass: 'btn-red',
                                                action: function () {
                                                    searchPatients();
                                                }
                                            },
                                            close: function () {
                                            }
                                        }
                                    });

                                },
                                success: function (data) {
                                    $("#holder_loading").hide();
                                    if( data.length > 0)
                                    {
                                        //var table = "<table class='table table-striped' id='table_result_patients'><head><tr><td>Nombre</td><td>DUI</td><td></td></tr></thead><tbody>";
                                        var table = "<table class='table table-striped' id='table_result_patients'><thead><tr><th>Nombre</th><th>DUI</th><th></th></tr></thead><tbody>";
                                        for(i=0; i < data.length; i++)
                                        {    
                                            var routeEdit = "{{ path('paciente_edit', { 'id': "PLACEHOLDER" }) }}";
                                            routeEdit = routeEdit.replace("PLACEHOLDER", data[i]['pac_id']);
                                            
                                            var routeShow = "{{ path('paciente_show', { 'id': "PLACEHOLDER" }) }}";
                                            routeShow = routeShow.replace("PLACEHOLDER", data[i]['pac_id']);
                                            
                                            var btn_group = "<div class='btn-group' role='group'>";
                                                btn_group += "<button type='button' class='label bg-danger-400 dropdown-toggle' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'>";
                                                btn_group += "Acción";
                                                btn_group += "<span class='caret'></span>";
                                                btn_group += "</button>";
                                                btn_group += "<ul class='dropdown-menu dropdown-menu-right'>";
                                                btn_group += "<li><a href='"+routeShow+"'><i class='fa fa-folder-open'></i> Ver</a></li>";
                                                btn_group += "<li><a href='"+routeEdit+"'><i class='fa fa-edit'></i> Editar</a></li>";
                                                btn_group += "</ul>";
                                                btn_group += "</div>";
                                            
                                            table += "<tr>";
                                            table += "<td>"+data[i]['fullname']+"</td>";
                                            table += "<td>"+data[i]['dui']+"</td>";
                                            table += "<td>"+btn_group+"</td>";

                                            table += "</tr>";
                                        }
                                        table += "</body></table>";
                                        
                                    }
                                    else
                                    {
                                        table = "<br><div class='alert alert-danger'><i class='glyphicon glyphicon-exclamation-sign'></i> No se han encontrado regístros</div>";
                                    }
                                    $("#result_search_patients").html(table);
                                    if( $("body").find("#table_result_patients").size() == 1 )
                                    {
                                        $("body").find("#table_result_patients").DataTable({
                                            "searching": false,
                                            "bFilter": false,
                                            "bInfo": false,
                                            "bLengthChange": false,
                                            "pageLength": 5,
                                            "language":{
                                                oPaginate: {
                                                    sFirst: "Primero",
                                                    sLast: "último",
                                                    sNext: "Siguiente",
                                                    sPrevious: "Anterior"
                                                    },
                                            },
                                            "order": [[ 0, "desc" ]]
                                        });
                                    }
                                    
                                }
                            });
                    }
                    
                    $.datepicker.regional['es'] = {
                        closeText: 'Cerrar',
                        prevText: '< Ant',
                        nextText: 'Sig >',
                        currentText: 'Hoy',
                        monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
                        monthNamesShort: ['Ene','Feb','Mar','Abr', 'May','Jun','Jul','Ago','Sep', 'Oct','Nov','Dic'],
                        dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
                        dayNamesShort: ['Dom','Lun','Mar','Mié','Juv','Vie','Sáb'],
                        dayNamesMin: ['Do','Lu','Ma','Mi','Ju','Vi','Sá'],
                        weekHeader: 'Sm',
                        dateFormat: 'yy-mm-dd',
                        firstDay: 1,
                        isRTL: false,
                        showMonthAfterYear: false,
                        yearSuffix: ''
                    };
                    $.datepicker.setDefaults($.datepicker.regional['es']);
                    $( ".birth_date" ).datepicker({
                        changeMonth: true,
                        changeYear: true,
                        yearRange: '1945:'+(new Date).getFullYear()
                    });
                    
                    
                    $(".radioPassword").change(function(){
                        var opt = $(this).val();
                        if( opt == "yes")
                        {
                            $("#change-password").show();
                        }else{
                            $("#change-password").hide();
                        }
                    });
                    
                    $("#btn-add-social-network").on("click", function(){
                        var url = $("#url").val();
                        var social_net_id = $("#social-network-list").val();
                        var txt = $("#social-network-list option:selected").text();
                        
                        if( $.trim(url) != "" )
                        {
                            
                            var rowCount = $('#table-social-network >tbody >tr').length;
                            if( rowCount == 0 )
                            {
                                 $("#table-social-network").show();
                            }

                            
                            var tr = "<tr id='"+social_net_id+"'><td>"+txt+"</td><td>"+url+"</td><td><button class='btn btn-danger btn-sm removeNetwork'>x</button></td></tr>";
                            $("#table-social-network").append(tr);
                            $("#url").val("");
                        }
                    });
                    
                    $("body").on("click",".removeNetwork", function(){
                        
                        $(this).closest("tr").remove();
                        
                        var rowCount = $('#table-social-network >tbody >tr').length;
                        if( rowCount == 0 )
                        {
                            $("#table-social-network").hide();
                        }
                        else
                        {
                            $("#table-social-network").show();
                        }
                    });
                    
                   
                    if( $('#table-social-network >tbody >tr').length == 0 )
                    {
                        $("#table-social-network").hide();
                    }
                    
                    
                    //$("#listSpecialities")
                    //======================================================
                    //======================================================
                    // Default initialization
                    // Simple toolbar
                    $('.wysihtml5-default').wysihtml5({
                        parserRules:  wysihtml5ParserRules,
                        stylesheets: ["{{ asset('bundles/admin/template_clients/assets/css/components.css') }}  "],
                        "font-styles": true, // Font styling, e.g. h1, h2, etc. Default true
                        "emphasis": true, // Italics, bold, etc. Default true
                        "lists": true, // (Un)ordered lists, e.g. Bullets, Numbers. Default true
                        "html": false, // Button which allows you to edit the generated HTML. Default false
                        "link": true, // Button to insert a link. Default true
                        "image": false, // Button to insert an image. Default true,
                        "action": true, // Undo / Redo buttons,
                        "color": true // Button to change color of font
                    });
                    
                    $("#title").val("{{ user.UsuTitulo }}").change();

                            


                    // Style form components
                    $('.styled').uniform();
                    
                    
                    $( "#birthdate" ).datepicker({
                        changeMonth: true,
                        changeYear: true,
                        yearRange: '1945:'+(new Date).getFullYear()
                    });
                    
                    $("div.bhoechie-tab-menu>div.list-group>a").click(function(e) {
                        e.preventDefault();
                        $(this).siblings('a.active').removeClass("active");
                        $(this).addClass("active");
                        var index = $(this).index();
                        $("div.bhoechie-tab>div.bhoechie-tab-content").removeClass("active");
                        $("div.bhoechie-tab>div.bhoechie-tab-content").eq(index).addClass("active");
                    });
                    
                    $('a[data-toggle=tab]').click(function(){
                        
                        
                        
                    });
                    
                    $("#scheduleWeekly").weekly({
                        hour_format: 12,
                        //start_from: "09:00 AM" 
                    });
                    
                    //=====================================
                    //Set the schedule if exists
                    //=====================================
                    {% for key,value in schedule %}

                        {% for hour in value %}
                            $(".{{ key }}").each(function(){
                                if( $(this).closest(".weekly_column_hour").data("weeklyhour") == "{{ hour }}" )
                                {
                                    $(this).addClass("active");
                                }
                            });

                        {% endfor %} 
                        
                    {% endfor %}    


                });
                
                
               

        </script>
    {% endblock %}    
