{% extends "Layout/base_emr/_clients_base.html.twig" %}

{% block title_page %}
        EMR || Listado de Pacientes
{% endblock %}

{% block breadcrumb %}
    {{ include('EmrBundle:Dashboard:_breadcrumb.html.twig' )  }}
{% endblock %} 

{% block submenutop %}
    {{ include('EmrBundle:Dashboard:_submenu.html.twig' )  }}
{% endblock %} 

{% block body %}
    <h1>Listado de pacientes</h1>
    
    <!-- Check the notifications -->
    <div id="holder_msg">
        {% for message in app.session.flashbag().get("success") %}
            <div class="alert alert-success"><i class="fa fa-check-circle"></i> {{message}}</div>
        {% endfor %}
        {% for message in app.session.flashbag().get("error") %}
            <div class="alert alert-danger"><i class="fa fa-close"></i> {{message}}</div>
        {% endfor %}
    </div>
    <!-- End notifications -->
    {% if pacientes|length > 0%}

       <table class="table table-striped" id="patients_grid">
           <thead>
               <tr>
                   <th>Nombre</th>
                   <th>Dui</th>
                   <th>Genero</th>
                   <th>Email</th>
                   <th>fecha creación</th>
                   <th>Acciones</th>
               </tr>
           </thead>
           <tbody>
           </tbody>
       </table>
    {% else %}
        <div class="alert alert-info" role=""><i class="fa fa-info-circle"></i> No hay regístros creados</div>
    {% endif %}    
    <ul class="list-inline">
        <li>
            <a href="{{ path('paciente_new') }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i> Nuevo</a>
        </li>
    </ul>

{% endblock %}

{% block codejs %}
    <script>
        $(document).on("ready",function(){
            
            if( $("#patients_grid").size() == 1 )
            {
                $('#patients_grid').DataTable({
                    "bProcessing": true,
                    "serverSide": true,
                    "ajax":{
                       url :"{{ path('paciente_list') }}", // json datasource
                       type: "post",  // type of method  , by default would be get
                       error: function(){  // error handling code
                         $("#patients_grid_processing").css("display","none");
                       }
                     },
                    "columnDefs": [ {
                        "targets": -1,
                        "data": null,
                        //"defaultContent": "<button>Click!"+pac_id+"</button>"
                        "render": function ( data, type, full, meta ) {
                            var buttonID = data[5];
                            var routeShow = "{{ path('paciente_show', { 'id': "PLACEHOLDER" }) }}";
                            var routeEdit = "{{ path('paciente_edit', { 'id': "PLACEHOLDER" }) }}";

                            routeShow = routeShow.replace("PLACEHOLDER", buttonID);
                            routeEdit = routeEdit.replace("PLACEHOLDER", buttonID);
                            var listBtn = "<a href="+routeShow+" class='btn btn-default'><i class='fa fa-folder-open'></i> Ver</a>";
                            listBtn += " <a href="+routeEdit+" class='btn bg-teal-400'><i class='fa fa-edit'></i> Editar</a>";

                            return listBtn;
                        }
                    } ]         
                });
                
                $('.dataTables_filter input[type=search]').attr('placeholder','Escribar para filtrar...');
                $('.dataTables_length select').select2({
                    minimumResultsForSearch: Infinity,
                    width: 'auto'
                });
            }
            
            
           /*
           var table = $('.datatable-reorder').DataTable({});
            // Add placeholder to the datatable filter option
            $('.dataTables_filter input[type=search]').attr('placeholder','Escribar para filtrar...');
            // Enable Select2 select for the length option
            $('.dataTables_length select').select2({
                minimumResultsForSearch: Infinity,
                width: 'auto'
            });
            //End
            */
        });
    </script>
{% endblock %}    
