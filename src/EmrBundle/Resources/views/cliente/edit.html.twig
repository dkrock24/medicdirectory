{% extends "Layout/base_emr/_clients_base.html.twig" %}

{% block title_page %}
        EMR || Edición del establecimiento
{% endblock %}

{% block breadcrumb %}
    {{ include('EmrBundle:Dashboard:_breadcrumb.html.twig' )  }}
{% endblock %} 

{% block submenutop %}
    {{ include('EmrBundle:Dashboard:_submenu.html.twig' )  }}
{% endblock %} 

{% block body %}
    <style>
        .border-warning-available{
            border: solid 1px #E44F4C;
            border-top-width: 1px;
            padding-top: 10px;
            padding-right: 10px;
            padding-bottom: 5px;
            padding-left: 10px;
            margin-bottom: 10px;
            background: #F5F5F5;
        }
        .has-error input {
            border-width: 2px;
        }

         .validation.text-danger:after {
            content: 'Tarjeta invalida';
        }

        .validation.text-success:after {
            content: 'Tajeta valida';
        }
        
        .div_pay{
            display: none;
        }
        
        .pac-container{
            z-index: 99999999999999 !important;
          }
    </style>
    <script type="text/javascript" src="{{ asset('bundles/admin/add-on/Jquery-mask/jquery.mask.js') }}"></script>
    <div class="page-header-content">
        <div class="page-title">
            <h4>
                {# <a href="{{ app.request.headers.get('referer') }}"> #}
                <a href="{{ path('emr_dashboard') }}">     
                <i class="icon-arrow-left52 position-left"></i>
                <span class="text-semibold">Dashboard</span>
                </a> - Edit Institution

                <small class="display-block">Client Form!</small>
            </h4>
                
               
        {#    
        <div class="heading-elements">
            <div class="heading-btn-group">
                <a href="#" class="btn btn-link btn-float has-text"><i class="icon-bars-alt text-primary"></i><span>Statistics</span></a>
                <a href="#" class="btn btn-link btn-float has-text"><i class="icon-calculator text-primary"></i> <span>Invoices</span></a>
                <a href="#" class="btn btn-link btn-float has-text"><i class="icon-calendar5 text-primary"></i> <span>Schedule</span></a>
            </div>
        </div>
        #}
        </div>
    </div>
 
    <div class="row">
        <div class="col-lg-12">

            <!-- Check the notifications -->
            {% for message in app.session.flashbag().get("success") %}
                <div class="alert alert-success alert-styled-left alert-arrow-left alert-component"> {{message}}
                    
                    {% if app.user.getUsuId() is defined and app.user.getUsuId() > 0 %}
                    {% else %}
                        , Login <a href="{{path('emr_homepage')}}">Here</a>
                    {% endif %}
                    
                    
                </div>
            {% endfor %}
            {% for message in app.session.flashbag().get("error") %}
                <div class="alert alert-danger alert-styled-left alert-arrow-left alert-component"><i class="fa fa-close"></i> {{message}}</div>
            {% endfor %}
            <!-- End notifications -->
        </div>
    </div>

    {#
    {{ form_start(edit_form) }}
        {{ form_widget(edit_form) }}
        <input type="submit" value="Edit" />
    {{ form_end(edit_form) }}
    #}
    <div class="panel border-left-lg border-left-success">
        <div class="panel-heading">
            <h6 class="panel-title"><i class="fa fa-hospital-o"></i> The fields with (*) are required </h6>
            {#
            <div class="heading-elements">
                <ul class="icons-list">
                    <li><a data-action="collapse"></a></li>
                    <li><a data-action="reload"></a></li>
                    <li><a data-action="close"></a></li>
                   
                </ul>
            </div>
            #}
        </div>
        <div class="panel-body">
            
            <div class="row">
            <div class="col-lg-12">
        {{ form_start(edit_form, {'attr': {'class': 'steps-basic steps-validation'}}) }}
                <div class="form_error">{{ form_errors(edit_form)}}</div>
                <h6>Representative </h6>
                <fieldset title="1">
						<!--<legend class="text-semibold">Establecimiento</legend>-->
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="row">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <div class="alert alert-info alert-styled-left alert-arrow-left alert-component">
                                            Institution Information
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="form_error">{{ form_errors(edit_form.cliTipCli)}}</div>
                                            <label for="" class=" control-label">Institution type: <span class="text-danger">*</span></label>
                                            <div class="">{{ form_widget(edit_form.cliTipCli,  { 'attr': {'class': 'select'} } ) }}</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                            <div class="form-group">
                                                <div class="form_error">{{ form_errors(edit_form.cliNombre)}}</div>
                                                <label for="" class=" control-label">Tradename: <span class="text-danger">*</span></label>
                                                <div class="">{{ form_widget(edit_form.cliNombre) }}{# {{ form_widget(form.catalogName,  { 'attr': {'class': 'c4'} } ) }} #}</div>
                                            </div>
                                        </div>    
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="form_error">{{ form_errors(edit_form.cliNombreFiscal)}}</div>
                                            <label for="" class=" control-label">Tax Name: <span class="text-danger">*</span></label>
                                            <div class="">{{ form_widget(edit_form.cliNombreFiscal) }}{# {{ form_widget(form.catalogName,  { 'attr': {'class': 'c4'} } ) }} #}</div>
                                        </div>
                                    </div>    
                                </div>
                                <div class="row">
                                    <div class="col-md-4">    
                                        <div class="form-group">
                                            <div class="form_error">{{ form_errors(edit_form.cliMun)}}</div>
                                            <label for="" class=" control-label">Location: <span class="text-danger">*</span></label>
                                            <div class="">{{ form_widget(edit_form.cliMun) }}{# {{ form_widget(form.catalogName,  { 'attr': {'class': 'c4'} } ) }} #}</div>
                                        </div>
                                    </div>    
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="form_error">{{ form_errors(edit_form.cliDireccion)}}</div>
                                            <label for="" class=" control-label">Address: <span class="text-danger">*</span></label>
                                            <div class="">{{ form_widget(edit_form.cliDireccion) }}{# {{ form_widget(form.catalogName,  { 'attr': {'class': 'c4'} } ) }} #}</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="form_error">{{ form_errors(edit_form.cliTelefono1)}}</div>
                                            <label for="" class=" control-label">Telephone 1: <span class="text-danger">*</span></label>
                                            <div class="">{{ form_widget(edit_form.cliTelefono1) }}{# {{ form_widget(form.catalogName,  { 'attr': {'class': 'c4'} } ) }} #}</div>
                                        </div>
                                    </div>    
                                </div>        
                                <div class="row">
                                    <div class="col-md-4" style="display:none">    
                                        <div class="form-group">
                                            <div class="form_error">{{ form_errors(edit_form.cliNit)}}</div>
                                            <label for="" class=" control-label">Document ID: <span class="text-danger">*</span></label>
                                            <div class="">{{ form_widget(edit_form.cliNit) }}{# {{ form_widget(form.catalogName,  { 'attr': {'class': 'c4'} } ) }} #}</div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-4" style="display:none">>
                                        <div class="form-group">
                                            <div class="form_error">{{ form_errors(edit_form.cliTelefono2)}}</div>
                                            <label for="" class=" control-label">Telephone 2:</label>
                                            <div class="">{{ form_widget(edit_form.cliTelefono2) }}{# {{ form_widget(form.catalogName,  { 'attr': {'class': 'c4'} } ) }} #}</div>
                                        </div>
                                    </div>    
                                </div>
                                        
                                <div class="row">
                                        <div class="col-md-12">    
                                            <div class="form-group">
                                                <div class="form_error">{{ form_errors(edit_form.idEspecialidad)}}</div>
                                                <label for="" class=" control-label">Specialties type in this institution : <span class="text-danger">*</span></label>
                                                <div class="">{# {{ form_widget(edit_form.idEspecialidad) }} #}{{ form_widget(edit_form.idEspecialidad,  { 'attr': {'class': 'select', 'required':true} } ) }}</div>
                                            </div>
                                        </div>    
                                </div>
                                <div class="row">
                                        <div class="col-md-4">    
                                            <div class="form-group">
                                                <div class="form_error"></div>
                                                <label for="" class=" control-label"></label>
                                                <div class=""><button type="button" id="btn-map" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg"><i class="glyphicon glyphicon-map"></i> Location on Google map</button></div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">    
                                            <div class="form-group">
                                                <div class="form_error">{{ form_errors(edit_form.cliUbicacionLat)}}</div>
                                                <label for="" class=" control-label">Latitude: </label>
                                                <div class="">{# {{ form_widget(edit_form.idEspecialidad) }} #}{{ form_widget(edit_form.cliUbicacionLat,  { 'attr': {'class': '', 'required':false} } ) }}</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">    
                                            <div class="form-group">
                                                <div class="form_error">{{ form_errors(edit_form.cliUbicacionLon)}}</div>
                                                <label for="" class=" control-label">Longitude: </label>
                                                <div class="">{# {{ form_widget(edit_form.idEspecialidad) }} #}{{ form_widget(edit_form.cliUbicacionLon,  { 'attr': {'class': '', 'required':false} } ) }}</div>
                                            </div>
                                        </div> 
                                            
                                </div>            
                                       
                            </div>
                            <div class="col-lg-6">
                                <div class="row">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                        <div class="alert alert-info alert-styled-left alert-arrow-left alert-component">
                                            Representative Information
                                        </div>
                                    </div>
                                </div>
                                <div class="row">

                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="form_error"></div>
                                            <label for="" class=" control-label">First Name: <span class="text-danger">*</span></label>
                                            <div class="">
                                                <input type="text" id="nameone_representer" name="nameone_representer" placeholder="Primer Nombre" class="form-control" value="{{ getUserRepresenter[0].usu_nombre }}" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="form_error"></div>
                                            <label for="" class=" control-label">Second Name: <span class="text-danger">*</span></label>
                                            <div class="">{# {{ form_widget(form.catalogName,  { 'attr': {'class': 'c4'} } ) }} #}
                                                <input type="text" id="nametwo_representer" name="nametwo_representer" placeholder="Segundo Nombre" class="form-control" value="{{ getUserRepresenter[0].usu_segundo_nombre }}" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="form_error"></div>
                                            <label for="" class=" control-label">Last Name: <span class="text-danger">*</span></label>
                                            <div class=""><input type="text" id="lastnameone_representer" name="lastnameone_representer" placeholder="Primer Apelldo" class="form-control" value="{{ getUserRepresenter[0].usu_primer_apellido }}" required></div>
                                        </div>
                                    </div>        
   
                                </div>
                                <div class="row">
                                    
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <div class="form_error"></div>
                                            <label for="" class=" control-label">Second Surname:</label>
                                            <div class=""><input type="text" id="lastnametwo_representer" name="lastnametwo_representer" placeholder="Segundo Apelldo" class="form-control" value="{{ getUserRepresenter[0].usu_segundo_apellido }}" ></div>
                                        </div>
                                    </div>    
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Representative Gender: <span class="text-danger">*</span></label>
                                            <select name="gender_representer"  id="gender_representer" data-placeholder="Genero..." required class="select">
                                                {% if getUserRepresenter[0].usu_genero is defined and getUserRepresenter[0].usu_genero == "m" %}
                                                    <option value="m" selected="selected">Male</option> 
                                                    <option value="f">Feamle</option> 
                                                {% else %}
                                                    <option value="m">Male</option> 
                                                    <option value="f" selected="selected">Feamle</option> 
                                                {% endif %}    
                                                
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                                <div class="form-group">
                                                    <label>Email Addrres:</label>
                                                    <input type="text" value="{{ getUserRepresenter[0].cli_usu_correo }}" name="email_representer" id="email_representer" placeholder="Email" class="form-control required">
                                                </div>
                                            </div>            
                                </div>

                                <div class="row">
                                    <div class="col-md-4">
                                        
                                         {# {{ dump(getUserRepresenter) }} #} 
                                        
                                         
                                         
                                         
                                        <div class="form-group has-success has-feedback">
                                            <label>Representative User: <span class="text-danger">*</span></label>
                                            <input type="text" value="{{ getUserRepresenter[0].usu_usuario }}" name="user_representer" id="user_representer" placeholder="Usuario" class="form-control" required readonly>
                                            <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-4">        
                                        <div class="form-group">
                                            <label>Password: </label>
                                            <input type="password" id="password_representer" name="password_representer" placeholder="Password" class="form-control ">
                                        </div>
                                    </div>
                                    <div class="col-md-4">        
                                        <div class="form-group">
                                            <label>Repieat Password: </label>
                                            <input type="password" id="password_representer_repeat" name="password_representer_repeat" placeholder="Repita Password" class="form-control ">
                                        </div>  
                                    </div>

                                    <div class="col-md-6">
                                        <div class="row">
                                            
                                            <div class="col-md-12" style="display:none">
                                                <div class="form-group">
                                                    
                                                    <label>Brith Day: <span class="text-danger">*</span></label>
                                                    <div class=""><input type="text" value="{{ getUserRepresenter[0].cli_usu_fecha_nacimiento }}" id="birth_date" name="birth_date" class="form-control" required readonly="readonly"></div>
                                                </div>

                                            </div>
                                            <div class="col-md-12" style="display:none">
                                                <div class="form-group">
                                                    <div>&nbsp;</div>
                                                    <div class="checkbox">
                                                        <label>
                                                            {% if representerIsDoctorOrAssistant > 0  %}
                                                                <input type="checkbox" checked="checked" value="" name="user_representer_doctor" id="user_representer_doctor" class="user_representer_doctor" >
                                                            {% else %}
                                                                <input type="checkbox" value="" name="user_representer_doctor" id="user_representer_doctor" class="user_representer_doctor" >
                                                            {% endif %}    
                                                        <span clas="">
                                                           Quiero asociar mis datos de representante para usarlo como un doctor de este establecimiento    
                                                        </span></label>
                                                    </div>
                                                </div>
                                            </div>    
                                        </div>
                                    </div>
                                </div>
                            </div>            
                        </div>
                        <hr>
                        <!--
                        <div class="row">
                            <div class="col-md-10"></div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <div class="form_error"></div>
                                    <label for="" class=" control-label">Puedes ingresar el código de la persona que te ha referido(opcional):</label>
                                    <div class=""><input type="text" value="" placeholder="" class="form-control" id="referralId" name="referralId"></div>
                                </div>
                            </div>
                        </div> -->                               
                                        
                </fieldset>
                <h6>Drs</h6>
                <fieldset title="3">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <!--
                            <div class="alert alert-info alert-styled-left alert-arrow-left alert-component">
                                <strong>Nota:</strong> El monto a cobrar será de <strong>$30</strong> mensualmente por cada doctor/a que asocie a su establecimiento, este monto no incluye a usuarios tipo "Asistente"
                            </div>
                            -->
                        </div>
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div id="sections">
                                  
                                <div class="section">
                                    <div class="" style="padding: 5px;">
                                        <fieldset>
                                        <legend><i class="fa fa-user-plus" aria-hidden="true"></i> Username</legend>
                                        <div class="row">
                                            <div class="col-lg-2 col-md-6 col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label">First Name:</label>
                                                    <input name="nameone[]" id="nameone" value="" type="text" class="form-control inputAssName inputUser" required />
                                                </div>
                                            </div>
                                            <div class="col-lg-2 col-md-6 col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label">Second Name:</label>
                                                    <input name="nametwo[]" id="nametwo" value="" type="text" class="form-control inputAssName inputUser"  />
                                                </div>
                                            </div>
                                            <div class="col-lg-2 col-md-6 col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label">Last Name:</label>
                                                    <input name="lastnameone[]" id="lastnameone" value="" type="text" class="form-control inputAssName inputUser"  />
                                                </div>
                                            </div>
                                            <div class="col-lg-2 col-md-6 col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label">Second Surname:</label>
                                                    <input name="lastnametwo[]" id="lastnametwo" value="" type="text" class="form-control inputAssName inputUser"  />
                                                </div>
                                            </div>
                                            <div class="col-lg-2 col-md-6 col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label">Email Address:</label>
                                                    <input name="email[]" id="email" value="" type="text" class="form-control inputAssEmail inputUser" />
                                                </div>
                                            </div>
                                            <div class="col-lg-2 col-md-6 col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label">Username:</label>
                                                    <input name="username[]" id="username" value="" type="text" class="form-control user_to_location" required/>
                                                </div>
                                            </div>
                                            <input name="availbleUser[]" id="availbleUser" value="" type="hidden" class="form-control inputAvailable" />
                                            <div class="col-lg-2 col-md-6 col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label">Gender:</label>
                                                    <select name="gender[]" id="gender" class="form-control selectAssGender" required>
                                                        <option value="m">Male</option>
                                                        <option value="f">Female</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="col-lg-2 col-md-6 col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label">Password:</label>
                                                    <input name="password[]" id="password_user" value="" type="password" class="form-control inputAssPassword inputUser" placeholder="" />
                                                </div>
                                            </div>
                                            <div class="col-lg-2 col-md-6 col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label">Repeat Password:</label>
                                                    <input name="repeatpassword[]" id="password_user_again" value="" type="password" class="form-control inputAssPassword inputUser" placeholder=""/>
                                                </div>
                                            </div>
                                            <div class="col-lg-2 col-md-6 col-sm-6">
                                                <div class="form-group">
                                                    <label class="control-label">User type:</label>
                                                    <select name="typeUser[]" id="typeUser" class="form-control typeUser" required>
                                                        <option value="6">Doctor</option>
                                                        <!-- <option value="3">Asistente</option> -->
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="col-lg-2 col-md-6 col-sm-6" style="display:none">
                                                <div class="form-group">
                                                   <label class="control-label">&nbsp;<br><label>
                                                    <div class="checkbox">
                                                        <label>
                                                          <input type="checkbox" name="publicityWeb[]" checked="checked" class="publicityWeb"> Published on web
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                            {#
                                            <div class="col-lg-12 col-md-12 col-sm-12">
                                                <div class="form-group text-right">
                                                    
                                                    <a href="#" class='remove btn bg-danger-400 ' style="margin-top: 7px;" data-toggle="tooltip" data-placement="top" title="Remover Usuario"><b><i class="fa fa-user-times"></i></b> </a>
                                                </div>
                                            </div>
                                            #}
                                        </div>
                                        <!-- <div class="row">
                                            
                                        <!-- </div>-->
                                        <br>  
                                    </fieldset>
                                    </div>
                                </div>    
                                    {% if representerIsDoctorOrAssistant > 0  and getUsersLocation|length == 1 %}
                                       
                                    {% else %}
                                        {% for users in getUsersLocation %}
                                            
                                            {% if users.usu_id == getUserRepresenter[0].usu_id and  representerIsDoctorOrAssistant > 0 %}
                                            {% else %}
                                                <div class="section">
                                                    <div class="" style="padding: 5px;">
                                                        <fieldset>
                                                            <legend><i class="fa fa-user-plus" aria-hidden="true"></i> Username</legend>
                                                            <div class="row">
                                                                <div class="col-lg-2 col-md-6 col-sm-6">
                                                                    <div class="form-group">
                                                                        <label class="control-label">First Name:</label>
                                                                        <input name="nameone[]" id="nameone{{ loop.index }}" value="{{ users.usu_nombre }}" type="text" class="form-control inputAssName inputUser" required />
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-2 col-md-6 col-sm-6">
                                                                    <div class="form-group">
                                                                        <label class="control-label">Second Name:</label>
                                                                        <input name="nametwo[]" id="nametwo{{ loop.index }}" value="{{ users.usu_segundo_nombre }}" type="text" class="form-control inputAssName inputUser"  />
                                                                    </div>
                                                                </div>
         
                                                                <div class="col-lg-2 col-md-6 col-sm-6">
                                                                    <div class="form-group">
                                                                        <label class="control-label">Last Name:</label>
                                                                        <input name="lastnameone[]" id="lastnameone{{ loop.index }}" value="{{ users.usu_primer_apellido }}" type="text" class="form-control inputAssName inputUser" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-2 col-md-6 col-sm-6">
                                                                    <div class="form-group">
                                                                        <label class="control-label">Second Surname:</label>
                                                                        <input name="lastnametwo[]" id="lastnametwo{{ loop.index }}" value="{{ users.usu_segundo_apellido }}" type="text" class="form-control inputAssName inputUser"  />
                                                                    </div>
                                                                </div>    
                                                                <div class="col-lg-2 col-md-6 col-sm-6">
                                                                    <div class="form-group">
                                                                        <label class="control-label">Email Address:</label>
                                                                        <input name="email[]" id="email{{ loop.index }}" value="{{ users.cli_usu_correo }}" type="text" class="form-control inputAssEmail inputUser" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-2 col-md-6 col-sm-6">
                                                                    <div class="form-group has-success has-feedback">
                                                                        <label class="control-label">Username:</label>
                                                                        <input name="username[]" id="username{{ loop.index }}" value="{{ users.usu_usuario }}" type="text" class="form-control user_to_location" required readonly="readonly"/>
                                                                        <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>
                                                                    </div>
                                                                </div>
                                                                <input name="availbleUser[]" id="availbleUser" value="1" type="hidden" class="form-control inputAvailable" />
                                                                <div class="col-lg-2 col-md-6 col-sm-6">
                                                                    <div class="form-group">
                                                                        <label class="control-label">Gender:</label>
                                                                        <select name="gender[]" id="gender{{ loop.index }}" class="form-control selectAssGender" required>
                                                                            <option value="m">Male</option>
                                                                            <option value="f">Female</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-2 col-md-6 col-sm-6">
                                                                    <div class="form-group">
                                                                        <label class="control-label">Password:</label>
                                                                        <input name="password[]" id="password_user{{ loop.index }}" value="" type="password" class="form-control inputAssPassword inputUser"  placeholder=""/>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-2 col-md-6 col-sm-6">
                                                                    <div class="form-group">
                                                                        <label class="control-label">Repeat Password:</label>
                                                                        <input name="repeatpassword[]" id="password_user_again{{ loop.index }}" value="" type="password" class="form-control inputAssPassword inputUser"  placeholder="" />
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-2 col-md-6 col-sm-6">
                                                                    <div class="form-group">
                                                                        <label class="control-label">User type:</label>
                                                                        <select name="typeUser[]" id="typeUser{{ loop.index }}" class="form-control typeUser" required>
                                                                            {% if users.cli_usu_rol_id == 3 %}
                                                                                <!--<option value="3" selected="selected">Asistente</option> -->
                                                                                <option value="6">Doctor</option> 
                                                                            {% else %}
                                                                                <!-- <option value="3">Asistente</option>  -->
                                                                                <option value="6" selected="selected">Doctor</option> 
                                                                            {% endif %}
                                                                        </select>
                                                                    </div>
                                                                </div>

                                                                <div class="col-lg-2 col-md-6 col-sm-6" style="display:none">
                                                                    <div class="form-group">
                                                                       <label class="control-label">&nbsp;<br><label>
                                                                        <div class="checkbox">
                                                                            <label>
                                                                              {% if users.cli_usu_exponer == 1 %}
                                                                                  <input type="checkbox" name="publicityWeb[]" checked="checked" class="publicityWeb"> 
                                                                              {% else %}
                                                                                  <input type="checkbox" name="publicityWeb[]" class="publicityWeb"> 
                                                                              {% endif %}    
                                                                                                                                                            
                                                                              Published on web
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                {#
                                                                <div class="col-lg-12 col-md-12 col-sm-12">
                                                                    <div class="form-group text-right">

                                                                        <a href="#" class='remove btn bg-danger-400 ' style="margin-top: 7px;" data-toggle="tooltip" data-placement="top" title="Remover Usuario"><b><i class="fa fa-user-times"></i></b> </a>
                                                                    </div>
                                                                </div>
                                                                #}
                                                            </div>
                                                            <!--                
                                                            <div class="row">
                                                                
                                                            </div>-->
                                                            <br>  
                                                        </fieldset>
                                                    </div>
                                                </div>
                                            {% endif %}    
                                                                    
                                        {% endfor %}    
                                    {% endif %}  
                                    
                                
                            </div>
                            <hr>
                            {# <p><a href="#" class='addsection btn bg-teal-400 btn-labele btn-sm'><b><i class="fa fa-plus-circle"></i></b> Add user</a></p> #}
                            {# <p><span class='addsection btn bg-teal-400 btn-labele btn-sm'><b><i class="fa fa-plus-circle"></i></b> Add User</span></p> #}
                        </div>
                        
                    </div>
                    
                    
				</fieldset>
                <h6>Payment method</h6>
                <fieldset>
                    <div class="row"> 
                        <div class="col-lg-1 col-md-3 col-sm-3 col-xs-12">
                            {% for method in methodPay %}
                                <div class="radio ">
                                    <label class="text-right">
                                        {% if method.mepId == currentPayment[0].cli_metodo_pago_id %}  
                                            <input type="radio" name="optionPay" class="optionPay" id="optionsRadios1" value="{{ method.mepId }}" checked="true">
                                        {% else %}
                                            <input type="radio" name="optionPay" class="optionPay" id="optionsRadios1" value="{{ method.mepId }}" >
                                        {% endif %}    
                                        {{ method.mepMetodoPago }}
                                    </label>
                                </div>
                            {% endfor %}
                        </div>
                        <div class="col-lg-11 col-md-9 col-sm-9 col-xs-12">
                            {% for method in methodPay %}
                                {% if method.mepId == 1 %}
                                    <div id="pay_1" class="div_pay">
                                        <div class="panel panel-info"> 
                                            <div class="panel-heading"> 
                                                <h6 class="panel-title">Chash</h6> 
                                            </div> 
                                            <div class="panel-body"> Chash Description </div> 
                                        </div>
                                    </div>
                                {% endif %}
                                {% if method.mepId == 2 %}
                                    <div id="pay_2" class="div_pay">
                                        <div class="panel panel-info"> 
                                            <div class="panel-heading"> 
                                                <h6 class="panel-title">Credit Card</h6> 
                                            </div> 
                                            <div class="panel-body"> 
                                                
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="form-group">
                                                            <label for="cc-number" class="control-label">Card Number <small class="text-muted">[<span class="cc-brand">{{ brand }}</span>]</small></label>
                                                          
                                                            {% if creditCard != "" %}
                                                                <input id="cc-number" type="tel" class="input-lg form-control cc-number" autocomplete="cc-number" placeholder="{{ creditCard }}" readonly="readonly">
                                                                {% set cardNumber = creditCard %}
                                                            {% else %} 
                                                                <input id="cc-number" type="tel" class="input-lg form-control cc-number" autocomplete="cc-number" placeholder="•••• •••• •••• ••••" required>
                                                            {% endif %}
                                                            
                                                        </div>

                                                        <div class="form-group">
                                                            <label for="cc-exp" class="control-label">Expiration Date</label>
                                                            {% if exp != "" %}
                                                                <input id="cc-exp" type="tel" class="input-lg form-control cc-exp" autocomplete="cc-exp" placeholder="{{ exp }}" readonly="readonly">
                                                            {% else %}
                                                                <input id="cc-exp" type="tel" class="input-lg form-control cc-exp" autocomplete="cc-exp" placeholder="MM / YY" required>
                                                            {% endif %}
                                                        </div>

                                                        <div class="form-group">
                                                            <label for="cc-cvc" class="control-label">CVC</label>
                                                            {% if cvc != "" %}
                                                                <input id="cc-cvc" type="tel" class="input-lg form-control cc-cvc" autocomplete="off" placeholder="{{ cvc }}" readonly="readonly">
                                                            {% else %}
                                                                <input id="cc-cvc" type="tel" class="input-lg form-control cc-cvc" autocomplete="off" placeholder="•••" required>
                                                            {% endif %}
                                                            
                                                        </div>
                                                  
                                                        {% if creditCard is defined and creditCard != "" %}
                                                           
                                                            {% set displayChange = "" %}
                                                        {% else %}
                                                            
                                                             {% set displayChange = 'style=display:none' %}
                                                        {% endif %}   
                                                       <div id="enable_card" class="text-left" {{ displayChange }}><span class="btn btn-lg btn-primary"> Cahnge register data</span></div>
                                                        <!--
                                                        <div class="form-group">
                                                            <label for="numeric" class="control-label">Restrict numeric</label>
                                                            <input id="numeric" type="tel" class="input-lg form-control" data-numeric>
                                                        </div>
                                                        -->
                                                        {% if creditCard is defined and creditCard == "" %}
                                                            {% set display = "" %}
                                                            
                                                        {% else %}
                                                            
                                                            {% set display = 'style=display:none' %}
                                                        {% endif %}    
                                                        <button id="btn-check-credit-card" class="btn btn-lg btn-primary" {{ display }}><i class="fa fa-credit-card-alt" aria-hidden="true"></i> Validate</button>
                                                        
                                                        <h2 class="validation"></h2>
                                                        <span id="use-same-card"></span>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        
                                                        <div class="alert alert-info alert-styled-left alert-arrow-left alert-component">
                                                            <i class="fa fa-credit-card-alt" aria-hidden="true"></i> Credit Card valid:
                                                        </div>
                                                        <ul class="list-unstyled">
                                                            <li>Visa</li>
                                                            <li>MasterCard
                                                            <li>American Express</li>
                                                            <li>Diners Club</li>
                                                            <li>Discover</li>
                                                            <li>UnionPay</li>
                                                            <li>JCB</li>
                                                            <li>Maestro</li>
                                                            <li>Forbrugsforeningen</li>
                                                            <li>Dankort</li>
                                                        </ul>    
                                                    </div>
                                                </div>
                                            </div> 
                                        </div>
                                    </div>
                                {% endif %}
                                {% if method.mepId == 3 %}
                                    <div id="pay_3" class="div_pay">
                                        <div class="panel panel-info"> 
                                            <div class="panel-heading"> 
                                                <h6 class="panel-title">CHEQUE</h6> 
                                            </div> 
                                            <div class="panel-body"> Description Check </div> 
                                        </div>
                                    </div>
                                {% endif %}
                                {% if method.mepId == 4 %}
                                <!--
                                    <div id="pay_4" class="div_pay">
                                        <div class="panel panel-info"> 
                                            <div class="panel-heading"> 
                                                <h6 class="panel-title">BANk</h6> 
                                            </div> 
                                            <div class="panel-body">
                                                Deposito a cuenta o transferencia bancaria<br>
                                                BAC CREDOMATIC : <strong>112862321</strong> a Nombre de Rafael Fernando Gutiérrez Tejada 
                                            </div> 
                                        </div>
                                    </div>
                                -->
                                {% endif %}
                                {% if method.mepId == 5 %}
                                    <div id="pay_5" class="div_pay">
                                        <div class="panel panel-info"> 
                                                <div class="panel-heading"> 
                                                    <h6 class="panel-title">PAYPAL</h6> 
                                                </div> 
                                                <div class="panel-body">
                                                    <img src="https://www.paypalobjects.com/webstatic/mktg/logo-center/logotipo_paypal_tarjetas.jpg" border="0" alt="" />
                                                    <hr>
                                                    <table class="table">
                                                        <thead>
                                                            <tr>
                                                                <th></th>
                                                                <th>Plan</th>
                                                                <th>Period</th>
                                                                <th>Price</th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                    {% for value in pricing %}
                                                        <tr>
                                                            <td>
                                                                {% if value.id == 1 %}  
                                                                    <input type="radio" name="optionPricing" class="optionPricing" id="" value="{{ value.id }}" checked="true">
                                                                {% else %}
                                                                    <input type="radio" name="optionPricing" class="optionPricing" id="" value="{{ value.id }}" >
                                                                {% endif %}
                                                            </td>
                                                            <td>{{ value.plan }}</td>
                                                            <td>{{ value.mes }}</td>
                                                            <td>$ {{ value.precio|number_format(2, '.', ',') }}</td>
                                                            <td>{{ value.descripcion }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div> 
                                            </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </fieldset>
                <!-- <button type="submit" class="btn btn-primary stepy-finish">Submit <i class="icon-check position-right"></i></button>  -->      
        {{ form_end(edit_form)}}
            </div>
            </div>
        </div>
    </div>
    {#     
    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="modalMap">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="gridSystemModalLabel">Institution locate Map</h4>
                </div>
                <div class="modal-body">
                    <div id="dvMap" style="width:100%; height: 500px"></div>
                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="text-left"><button class="btn btn-primary" id="find_btn">Find my location</button></div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times" aria-hidden="true"></i> Close</button>
                            <button type="button" class="btn btn-success" id="btn-set-location"><i class="fa fa-map-marker" aria-hidden="true"></i> locate institution</button>
                        </div>
                    </div>
                    
                </div>    
            </div>
        </div>
    </div>
    #}
    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="modalMap">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="gridSystemModalLabel"> Map for locate the institution</h4>
                </div>
                <div class="modal-body">
                    {#
                    <form>
                        <input id="geocomplete" type="text" placeholder="Type in an address" value="El Salvador" style="width:350px" />
                        <input id="find" type="button" value="find" />

                        <fieldset>
                          <label>Latitude</label>
                          <input name="lat" type="text" value="">

                          <label>Longitude</label>
                          <input name="lng" type="text" value="">

                          <label>Formatted Address</label>
                          <input name="formatted_address" type="text" value="">
                        </fieldset>

                        <a id="reset" href="#" style="display:none;">Reset Marker</a>
                      </form>
                    #}
                     <form>
                        <div class="row">
                            <div class="col-lg-8 col-md-8">
                                {#
                                <input id="geocomplete" type="text" placeholder="Type in an address" value="" style="width:350px" class="form-control"/>
                                <input id="find" type="button" value="Buscar" />
                                #}
                                <div class="input-group">
                                    <input type="text" class="form-control" id="geocomplete" type="text" placeholder="Type in an address" value=""  class="form-control">
                                    <span class="input-group-btn">
                                      {# <button class="btn btn-default" type="button">Go!</button> #}
                                      <input id="find" type="button" value="Buscar" class="btn btn-primary"/>
                                    </span>
                                </div><!-- /input-group -->
                                
                            </div>
                            <div class="col-lg-4 col-md-4">
                                <input name="formatted_address" type="text" value="" class="form-control" placeholder="Dirección Formateada">
                            </div>
                        </div>
                        <hr>
                        <fieldset>
                          <div style="display:none">  
                            <label>Latitude</label>
                            <input name="lat" type="text" value="">

                            <label>Longitude</label>
                            <input name="lng" type="text" value="">
                          </div>
                        </fieldset>

                        <a id="reset" href="#" style="display:none;">Resetear Marker</a>
                      </form>
                    <div id="dvMap" style="width:100%; height: 500px" class="dvMap"></div>
                </div>
                <div class="modal-footer">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            {# <div class="text-left"><button class="btn btn-primary" id="find_btn">Find my locate</button></div> #}
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times" aria-hidden="true"></i> Close</button>
                            <button type="button" class="btn btn-success" id="btn-set-location" data-dismiss="modal"><i class="fa fa-map-marker" aria-hidden="true"></i> Locate my instituttion</button>
                        </div>
                    </div>
                    
                </div>    
            </div>
        </div>
    </div> 
    
    {#
    <ul>
        <li>
            <a href="{{ path('cliente_index') }}">Back to the list</a>
        </li>
        <li>
            {{ form_start(delete_form) }}
                <input type="submit" value="Delete">
            {{ form_end(delete_form) }}
        </li>
    </ul>
    #}
{% endblock %}

{% block codejs %}
     
    <script>
        $(document).on("ready", function(){
            
            $('#appbundle_cliente_cliNit').mask("9999-999999-999-9", {placeholder: "____-______-___-_"});
            $('#appbundle_cliente_cliTelefono1').mask("9999-9999", {placeholder: "(999) 999-9999"});
            $('#appbundle_cliente_cliTelefono2').mask("9999-9999", {placeholder: "____-____"});

            
            
            var users = [];
            //var creditCard = [];
            
            
            
            // Show form
            var form = $(".steps-validation").show();


            // Initialize wizard
            $(".steps-validation").steps({
                headerTag: "h6",
                bodyTag: "fieldset",
                transitionEffect: "fade",
                titleTemplate: '<span class="number">#index#</span> #title#',
                autoFocus: true,
                labels: {
                    current: "current step:",
                    pagination: "Pagination",
                    finish: "Save",
                    next: "Next",
                    previous: "Last",
                    loading: "Loading ..."
                },
                onStepChanging: function (event, currentIndex, newIndex) {

                    // Allways allow previous action even if the current form is not valid!
                    if (currentIndex > newIndex) {
                        return true;
                    }

                    // Forbid next action on "Warning" step if the user is to young
                    if (newIndex === 3 && Number($("#age-2").val()) < 18) {
                        return false;
                    }
                    
                    if (newIndex === 2 ) {
                        var num = 0;
                        $("body").find(".typeUser").each(function(){
                            if( $(this).val() == 6 ) 
                            {
                                num++;
                            }
                        });
                        if(num == 0 )
                        {
                            $.alert({
                                    icon: 'fa fa-user-times',
                                    title: 'Error!',
                                    content: 'You must create at least one user with a Doctor role',
                                    type: 'red',
                                    typeAnimated: true,
                            });
                            return false;
                        }
                    }
                    
                    // Needed in some cases if the user went back (clean up)
                    if (currentIndex < newIndex) {

                        // To remove error styles
                        form.find(".body:eq(" + newIndex + ") label.error").remove();
                        form.find(".body:eq(" + newIndex + ") .error").removeClass("error");
                    }
                    
                    if(currentIndex === 0)
                    {
                        setRepresenterAsDoctor();
                    }
                    
                    if( currentIndex === 1)
                    {
                        var available = checkAvilableUser();
                        //console.log(available);
                        if( !available )
                        {
                            return false;
                        }
                    }
                    

                    form.validate().settings.ignore = ":disabled,:hidden";
                    return form.valid();
                },

                onStepChanged: function (event, currentIndex, priorIndex) {
                    
                    

                    // Used to skip the "Warning" step if the user is old enough.
                    if (currentIndex === 2 && Number($("#age-2").val()) >= 18) {
                        form.steps("next");
                    }

                    // Used to skip the "Warning" step if the user is old enough and wants to the previous step.
                    if (currentIndex === 2 && priorIndex === 3) {
                        form.steps("previous");
                    }
                },

                onFinishing: function (event, currentIndex) {
                    form.validate().settings.ignore = ":disabled";
                    return form.valid();
                },

                onFinished: function (event, currentIndex) {
                    var methodPay = $('input:radio[name=optionPay]:checked').val();
                    //var methodPay = $("body").find("input:radio[name=optionPay]:checked").val();
                   // alert(methodPay);
                    if( methodPay == 2 )
                    {
                        if( $("#val_cc_number").size() == 0 )
                        {
                            if( $("#cc-number").val() != "" || $("#cc-exp").val() != "" || $("#cc-cvc").val() != ""  )
                            {    
                                $.alert({
                                    icon: 'fa fa-credit-card-alt',
                                    title: 'Error!',
                                    content: 'Credit Card updated. Please validate the credit card',
                                    type: 'red',
                                    typeAnimated: true,
                                });
                                return false;
                            }
                        }
                        else if( $("#val_cc_number").val() != 1 )
                        {
                            $.alert({
                                icon: 'fa fa-credit-card-alt',
                                title: 'Error!',
                                content: 'Credit Card not valid',
                                type: 'red',
                                typeAnimated: true,
                            });
                            
                            return false;
                        }
                        
                        sendFormRepresenter(users);
                        
                    }
                    else
                    {
                        //alert("Submitted! x");
                        sendFormRepresenter(users);
                        //alert("Submitted!");
                    }
                    
                }
            });


            // Initialize validation
            $(".steps-validation").validate({
                ignore: 'input[type=hidden], .select2-search__field', // ignore hidden fields
                errorClass: 'validation-error-label',
                successClass: 'validation-valid-label',
                highlight: function(element, errorClass) {
                    $(element).removeClass(errorClass);
                },
                unhighlight: function(element, errorClass) {
                    $(element).removeClass(errorClass);
                },

                // Different components require proper error label placement
                errorPlacement: function(error, element) {

                    // Styled checkboxes, radios, bootstrap switch
                    if (element.parents('div').hasClass("checker") || element.parents('div').hasClass("choice") || element.parent().hasClass('bootstrap-switch-container') ) {
                        if(element.parents('label').hasClass('checkbox-inline') || element.parents('label').hasClass('radio-inline')) {
                            error.appendTo( element.parent().parent().parent().parent() );
                        }
                         else {
                            error.appendTo( element.parent().parent().parent().parent().parent() );
                        }
                    }

                    // Unstyled checkboxes, radios
                    else if (element.parents('div').hasClass('checkbox') || element.parents('div').hasClass('radio')) {
                        error.appendTo( element.parent().parent().parent() );
                    }

                    // Input with icons and Select2
                    else if (element.parents('div').hasClass('has-feedback') || element.hasClass('select2-hidden-accessible')) {
                        error.appendTo( element.parent() );
                    }

                    // Inline checkboxes, radios
                    else if (element.parents('label').hasClass('checkbox-inline') || element.parents('label').hasClass('radio-inline')) {
                        error.appendTo( element.parent().parent() );
                    }

                    // Input group, styled file input
                    else if (element.parent().hasClass('uploader') || element.parents().hasClass('input-group')) {
                        error.appendTo( element.parent().parent() );
                    }

                    else {
                        error.insertAfter(element);
                    }
                },
                /*
                rules: {
                    email_representer: {
                        email: true
                    },
                    password_representer : {
                        minlength : 5
                    },
                    password_representer_repeat : {
                        minlength : 5,
                        equalTo : "#password_representer"
                    }
                    
                }
                */
            });

            $('.select').select2();
            
            //define template
            var template = $('#sections .section:first').clone();
            //$('#sections .section').remove();
            
            //==================================================================
            //This is the begin to clone de user form
            //==================================================================
            //define counter
            var sectionsCount = 1;

            //add new section
            $('body').on('click', '.addsection', function() {
                //prebt
                cloneSection("yes");
            });
            
            function cloneSection(increment)
            {
                //preventDe
                //increment
                if( increment == "yes")
                {
                    var sum = $("#sections .section").size();
                    sectionsCount++;
                    
                    //loop through each input
                    var section = template.clone().find(':input').each(function(){

                        //set id to store the updated section number
                        var newId = this.id + (sectionsCount + sum); //sectionsCount;

                        //update for label
                        $(this).prev().attr('for', newId);
                        $(this).addClass("cloned");
                        //update id
                        this.id = newId;

                    }).end()

                    //inject new section
                    .appendTo('#sections');
                    //$('#sections').prepend(section);
                    $('[data-toggle="tooltip"]').tooltip();
                    return false;
                    
                }else{
                    //loop through each input
                    var section = template.clone().find(':input').each(function(){

                        //set id to store the updated section number
                        var newId = this.id; //sectionsCount;

                        //update for label
                        $(this).prev().attr('for', newId);

                        //update id
                        this.id = newId;

                    }).end();

                    //inject new section
                    $('#sections').prepend(section);
                    $('[data-toggle="tooltip"]').tooltip();
                    //$("#newId").closest("fieldset").find("")
                    return false;
                }
                
            }

            //remove section
            $('#sections').on('click', '.remove', function() {
                //fade out section
                if( $(this).closest(".section").find("#nameone").size() == 1 )
                {
                    $("#user_representer_doctor").prop('checked', false);
                }  
                $(this).closest(".section").remove();
                /*$(this).parent().fadeOut(300, function(){
                    //remove parent element (main section)
                    $(this).parent().parent().empty();
                    return false;
                });
                */
                return false;
            });
            
            
            
            
            //==================================================================
            //End clone
            //==================================================================
            
           
           
            function checkAvilableUser()
            {
                var users = [];
                var error = 0;
                $(".section").each(function(index){
                    
                    var nameone = $(this).find("input[name='nameone[]']");
                    var valNameOne = $.trim( nameone.val() );
                    
                    var nametwo = $(this).find("input[name='nametwo[]']");
                    var valNameTwo = $.trim( nametwo.val() );
                    
                    var namethree = $(this).find("input[name='namethree[]']");
                    var valNameThree = $.trim( namethree.val() );
                    
                    var lastnameone = $(this).find("input[name='lastnameone[]']");
                    var valLastNameOne = $.trim( lastnameone.val() );
                    
                    var lastnametwo = $(this).find("input[name='lastnametwo[]']");
                    var valLastNameTwo = $.trim( lastnametwo.val() );
                    
                    var valPublicity = 0;
                    if( $(this).find("input[name='publicityWeb[]']").prop('checked') ) {
                        valPublicity = 1;
                    }

                    
                    var email = $(this).find("input[name='email[]']").val();
                    //var valEmail = $.trim( email.val() );
                    var username = $(this).find("input[name='username[]']");
                    var valUsername = $.trim(username.val() );
                    var password = $(this).find("input[name='password[]']");
                    var valPassword = $.trim( password.val() );
                    var password_cloned = $(this).find("input[name='password[]']").hasClass("cloned");
                    var password_again_cloned = $(this).find("input[name='repeatpassword[]']").hasClass("cloned");
                    var password_again =  $(this).find("input[name='repeatpassword[]']");
                    var gender = $.trim( $(this).find("select[name='gender[]']").val() );
                    var valPassword_again = $.trim( password_again.val() );
                    
                    var inputAvailable = $(this).find("input[name='availbleUser[]']").val();
                    var typeUser = $.trim( $(this).find("select[name='typeUser[]']").val() );
                    
                    //alert(inputAvailableX);
                    //alert(password_cloned);
                    
                    var msg = "";
                    if( valNameOne == "" && !nameone.hasClass("passed") )
                    {
                        msg = "Enter the first name";
                    }
                    else if( valUsername == "" && !username.hasClass("passed") )
                    {
                        msg = "Enter the Username";
                    }
                    else if ( password_cloned  || password_again_cloned )
                    {
                        
                        if( valPassword == "" &&  !password.hasClass("passed") )
                        {
                            msg = "Enter the password for the new user";
                            
                        }
                        else if(  valPassword_again == "" && !password_again.hasClass("passed")  )
                        {
                                msg = "Repeat password for the new user";
 
                        }
                        else if( valPassword != valPassword_again )
                        {
                            msg = "The passwords are not same";
                        }
                    }
                    else if( valPassword != "" ||  valPassword_again != "" )
                    {
                        if( valPassword != valPassword_again )
                        {
                            msg = "The passwords are not same";
                        }
                       
                    }
                    else if ( inputAvailable != 1 )
                    {
                        msg = "Valid the new user";
                    }
                    
                    if ( email == "" )
                    {
                        msg = "Enter the valid email address";
                    }
                    
                    console.log(email);
                    
                    if( msg != "")
                    {
                        
                        $.alert({
                            icon: 'glyphicon glyphicon-exclamation-sign',
                            title: 'Info!',
                            content: msg,
                            type: 'red',
                            typeAnimated: true,
                        });
                        
                        $('html, body').animate({
                            scrollTop: $(this).offset().top
                        }, 1000);
                        
                        users = [];
                        error++;
                        $(".section").removeClass("border-warning-available");
                        $(this).addClass("border-warning-available");
                        //break;
                        return false;
                        return "error";
                    }
                    else
                    {
                        item = {"nameone":valNameOne, "nametwo":valNameTwo, "namethree":valNameThree, "lastnameone":valLastNameOne, "lastnametwo":valLastNameTwo, "email":email, "username":valUsername, "password":valPassword, "gender":gender, "typeUser":typeUser,"valPublicity":valPublicity };
                        users.push(item);

                        $(this).removeClass("border-warning-available");
                    }
                });
                
                if( error == 0 )
                {
                    //console.log(users);
                    return users;
                    //return "ok";
                }else{
                    var users = [];
                    return false;
                }
                
            }
            
            checkCreditCard();
            function checkCreditCard()
            {
                var creditCard = [];
                $('[data-numeric]').payment('restrictNumeric');
                $('.cc-number').payment('formatCardNumber');
                $('.cc-exp').payment('formatCardExpiry');
                $('.cc-cvc').payment('formatCardCVC');

                $.fn.toggleInputError = function(erred) {
                  this.parent('.form-group').toggleClass('has-error', erred);
                  //console.log(this);
                  return this;
                };

                $('#btn-check-credit-card').on("click", function(e){

                    e.preventDefault();
                    var cardType = $.payment.cardType($('.cc-number').val());
                    $('.cc-number').toggleInputError(!$.payment.validateCardNumber($('.cc-number').val()));
                    $('.cc-exp').toggleInputError(!$.payment.validateCardExpiry($('.cc-exp').payment('cardExpiryVal')));
                    $('.cc-cvc').toggleInputError(!$.payment.validateCardCVC($('.cc-cvc').val(), cardType));
                    $('.cc-brand').text(cardType);

                    $('.validation').removeClass('text-danger text-success');
                    $('.validation').addClass($('.has-error').length ? 'text-danger' : 'text-success');
                    
                    if( $('.validation').hasClass("text-success") )
                    {
                        //$("#use-same-card").html("<button class='btn btn-info'></button>");
                        /*
                        creditCard['cc-number'] = $('.cc-number').val();
                        creditCard['cc-exp'] =  $('.cc-exp').val();
                        creditCard['cc-cvc'] = $('.cc-cvc').val();
                        creditCard['cc-brand'] = cardType;
                        */
                        val_cc_number = 1;
                        //console.log("ok");
                    }else{
                        //console.log("cagada");
                        //creditCard = [];
                        val_cc_number = 0;
                        var creditCard = "{{ creditCard }}";
                        if( creditCard != "" )
                        {
                            $("#use-same-card").html("<span class='btn btn-info' id='btn-use-same-card'>Usar tarjeta anterior</span>");
                        }
                         
                    }
                    
                    if( $("body").find("#val_cc_number").size() == 0 )
                    {
                        $("body").append("<input type='hidden' value=''  id='val_cc_number'>");
                    }
                    
                    $("body").find("#val_cc_number").val(val_cc_number);
                    
                    
                    //e.preventDefault();
                    //return creditCard;
                    
                });
                
                $("body").on("click","#btn-use-same-card", function(){
                        $("#pay_2").find(".form-group").each(function(){
                            $(this).removeClass("has-error");
                            $(this).find("input[type='text']").val("");
                        });
                        $("#cc-number").attr("placeholder", "{{ creditCard }}");
                        $("#cc-exp").attr("placeholder", "{{ exp }}");
                        $("#cc-cvc").attr("placeholder", "{{ cvc }}");
                        $(".cc-brand").text("{{ brand }}");
                        //$(this).attr("placeholder", "Type your answer here");
                        $('.validation').removeClass('text-danger text-success');
                        $("#use-same-card").empty();
                        if( $("body").find("#val_cc_number").size() == 0 )
                        {
                            $("body").append("<input type='hidden' value=''  id='val_cc_number'>");
                        }
                        $("#cc-number").prop('readonly', true);
                        $("#cc-exp").prop('readonly', true);
                        $("#cc-cvc").prop('readonly', true);
                        $("body").find("#val_cc_number").val(1);
                        
                        $("#btn-check-credit-card").hide();
                        $("#enable_card span").show();
                    });
                
                $("body").on("click","#enable_card span",function(){
                        $("#pay_2").find(".form-group").each(function(){
                            //$(this).removeClass("has-error");
                            //$(this).find("input[type='text']").prop('readonly', false);
                            
                        });
                        if( $("body").find("#val_cc_number").size() == 0 )
                        {
                            $("body").append("<input type='hidden' value=''  id='val_cc_number'>");
                        }
                        $("body").find("#val_cc_number").val(0);
                        $("#cc-number").attr("placeholder", "•••• •••• •••• ••••");
                        $("#cc-exp").attr("placeholder", "MM / YY");
                        $("#cc-cvc").attr("placeholder", "•••");
                        $(".cc-brand").empty();
                        
                        $("#cc-number").prop('readonly', false);
                        $("#cc-exp").prop('readonly', false);
                        $("#cc-cvc").prop('readonly', false);
                        $("#enable_card span").hide();
                        $("#btn-check-credit-card").show();
                        
                        //$("#use-same-card").html("<button class='btn btn-info' id='use-same-card'>Usar tarjeta anterior</button>");
                        $("#use-same-card").html("<span class='btn btn-info' id='btn-use-same-card'>Usar tarjeta anterior</span>");
                    });
                
            }
            
            
            validPayMethod();
            function validPayMethod()
            {

                var option = $('input[name=optionPay]:checked').val();
                $("#pay_"+option).show();
                
                $('input[name=optionPay]').change(function(){
                    //console.log($(this).val());
                    $(".div_pay").hide();
                    $("#pay_"+$(this).val()).show();
                    if($(this).val() != 2 )
                    {
                        $("#cc-number, #cc-exp, #cc-cvc").attr("required", false);
                    }else{
                        //$("#cc-number, #cc-exp, #cc-cvc").attr("required", true);
                    }
                });
                
                if( option != 2 )
                {
                    $("#cc-number, #cc-exp, #cc-cvc").attr("required", false);
                }else{
                    //$("#cc-number, #cc-exp, #cc-cvc").attr("required", true);
                }
            }
            
            function useDateRepresenterAsDoctor(number)
            {
                   var nameOneRepresenter = $("#nameone_representer").val();
                   var nameTwoRepresenter = $("#nametwo_representer").val();
                   var nameThreeRepresenter = $("#namethree_representer").val();
                   var lastnameOneRepresenter = $("#lastnameone_representer").val();
                   var lastnameTwoRepresenter = $("#lastnametwo_representer").val();
                   var emailRepresenter = $("#email_representer").val();
                   var userRepresenter = $("#user_representer").val();
                   var passRepresenter = $("#password_representer").val();
                   var genderRepresenter = $("#gender_representer").val();
                   $("#availbleUser").val(1);
                   
                   $("#nameone"+number).closest(".section").removeClass("border-warning-available"); 
                   
                   $("#nameone"+number).val(nameOneRepresenter);
                   $("#nametwo"+number).val(nameTwoRepresenter);
                   $("#namethree"+number).val(nameThreeRepresenter); 
                   $("#lastnameone"+number).val(lastnameOneRepresenter);
                   $("#lastnametwo"+number).val(lastnameTwoRepresenter);
                   
                   $("#password_user"+number).val(passRepresenter);
                   $("#password_user_again"+number).val(passRepresenter);
                   $("#email"+number).val(emailRepresenter);
                   $("#username"+number).val(userRepresenter);
                   $("#gender"+number).val(genderRepresenter);
                   
                   $("#nameone"+number).attr("readonly", true);
                   $("#nametwo"+number).attr("readonly", true);
                   $("#namethree"+number).attr("readonly", true);
                   $("#lastnameone"+number).attr("readonly", true);
                   $("#lastnametwo"+number).attr("readonly", true);
                   
                   $("#password_user"+number).attr("readonly", true);
                   $("#password_user_again"+number).attr("readonly", true);
                   $("#email"+number).attr("readonly", true);
                   $("#username"+number).attr("readonly", true);
                   //$("#gender").attr("readonly", true);
                   $("#gender"+number+" option:not(:selected)").prop('disabled', true);
            }

            $("body").on("blur","#user_representer, .user_to_location",function(){
                var user = $(this).val();
                var idInput = $(this).attr("id");
                var number = idInput.replace( /\D+/g, '');
                if( $.trim( user ) != "" )
                {
                    var readonly = 0;
                    $(".user_to_location").each(function(){
                        if( $(this).is('[readonly]') )
                        {
                            readonly++;
                            return false;
                        }
                    });
                    if( $.trim( user ) ==  $("#user_representer").val() && $(this).hasClass("user_to_location") && !$(this).is('[readonly]') && readonly != 1 )
                    {
                        $.confirm({
                            title: 'Confirm!',
                            content: '<p class="small">Este usuario ya ha sido tomado por un representante de este establecimiento!</p><p class="small"> Desea usar las mismas credenciales?</p>',
                            type: 'blue',
                            typeAnimated: true,
                            buttons: {
                                close: {
                                    text: 'Cancelar',
                                    btnClass: 'btn-red',
                                    //keys: ['enter', 'shift'],
                                    action: function(){
                                        $("#"+idInput).val("");
                                    }
                                },
                                somethingElse: {
                                    text: 'Ok',
                                    btnClass: 'btn-blue',
                                    //keys: ['enter', 'shift'],
                                    action: function(){
                                        useDateRepresenterAsDoctor(number);
                                        //$("#"+idInput).
                                    }
                                }
                            }
                        });
                        
                        //return false
                    }
                    else
                    {
                        checkAvailableUserDB(idInput);
                    }
                    
                }
                else
                {
                    $(this).closest(".form-group").removeClass("has-success has-feedback has-error");
                    $(this).closest(".form-group").find(".icon-status").remove();
                }
            });
            
            
            function checkAvailableUserDB(idInput)
            {
                var username = $("#"+idInput).val();
                
                if ( $("#"+idInput).is('[readonly]') ) {
                    return false;
                }
                
                if( $("#"+idInput).hasClass("user_to_location") )
                {
                    var exists_user_list = 0;
                    $(".user_to_location").each(function(){
                        var currentValue = $.trim( $(this).val() );
                        var currentId = $(this).attr("id");
                        if( currentValue  != "" && currentId != idInput)
                        {
                            //console.log(current+"-"+username);
                            if( currentValue == username )
                            {
                                exists_user_list++;
                                 
                                return false;
                            }
                        }
                    });
                    
                    if( exists_user_list == 1 )
                    {
                        $.alert({
                            icon: 'glyphicon glyphicon-remove-circle',
                            title: 'Error!',
                            content: '<p class="small">The user <strong>'+username+'</strong> already exists, please enter other</p>',
                            type: 'red',
                            typeAnimated: true,
                        });
                        //$("#"+idInput).val("");
                        $("#"+idInput).closest(".form-group").find(".icon-status").remove();    
                        $("#"+idInput).closest(".section").find(".inputAvailable").val("");
                        $("#"+idInput).closest(".section").find(".user_to_location").val("");
                        $("#"+idInput).closest(".form-group").removeClass("has-success has-error has-feedback");
                        //exists_user_list = 0;
                        return false;
                    }else{
                        
                    }
                }
                
                if( $.trim(username) == "" )
                {
                    //$('#available_representer').attr('checked', false); // Unchecks it
                    $.alert({
                            icon: 'glyphicon glyphicon-remove-circle',
                            title: 'Error!',
                            content: '<p class="small">Antes de verificar la disponibilidad del usuario debe llenar el campo: Usuario del representante</p> ',
                            type: 'red',
                            typeAnimated: true,
                        });
                   
                    return false;                  
                }
                
                $("#holder_loading").show();
				$.ajax({
                    type: "post",
                    //dataType: 'json',
                    url: "{{ path('cliente_check_available_user') }}",
                    data: {
                        username: username
                    },
                    error: function (data) {
                        $("#holder_loading").hide();
                        $.confirm({
                            icon: 'fa fa-remove',
                            title: 'Error!',
                            content: '<p class="small">An error has ocrred, request not send</p>',
                            type: 'red',
                            typeAnimated: true,
                            buttons: {
                                tryAgain: {
                                    text: 'Try again',
                                    btnClass: 'btn-red',
                                    action: function () {
                                        checkAvailableUserDB();
                                    }
                                },
                                close: function () {}
                            }
                        });
                    },
                    success: function (data) {
                        $("#holder_loading").hide();
                        if( $("#"+idInput).hasClass("user_to_location") )
                        {
                            $("#"+idInput).closest(".section").find(".user_available_location").val(1);
                        }
                        //alert( (data.email) );
                        if( data.available != undefined )
                        {
                            $("#"+idInput).closest(".form-group").find(".icon-status").remove();
                            //$("#holder_loading").hide();
                            if (data.available == 1 || data.available == "1")
                            {
                                if( $("#"+idInput).hasClass("user_to_location") )
                                {
                                    $("#"+idInput).closest(".section").find(".inputAvailable").val(1);
                                }

                                $("#"+idInput).closest(".form-group").removeClass("has-error");
                                $("#"+idInput).closest(".form-group").addClass("has-success has-feedback").append('<span class="glyphicon glyphicon-ok form-control-feedback icon-status" aria-hidden="true"></span>');
                            } 
                            else 
                            {        
                                //$('#available_representer').attr('checked', false); // Unchecks it
                                
                                
                                if( $("#"+idInput).hasClass("user_to_location") )
                                {
                                    var msg = "<p class='small'>The username <strong>"+username+"</strong>";
                                    var email = "";
                                    if( data.email != "" )
                                    {
                                        email = "Al asociarlo se le notificara al usuario por medio del email: <strong>"+data.email+"</strong></p>";
                                    }
                                    msg += " ya existe desea asociar este usuario a este establecimiento?</p>";
                                    msg += email;
                                    $.confirm({
                                        icon: 'fa fa-question-circle-o',
                                        title: 'Confirm data',
                                        content: msg,
                                        type: 'blue',
                                        typeAnimated: true,
                                        buttons: {
                                            tryAgain: {
                                                text: 'Si',
                                                btnClass: 'btn-green',
                                                action: function () {
                                                   //$("#"+idInput).closest(".section").find(".inputAssEmail").val(data.email);
                                                   $("#"+idInput).closest(".section").find(".selectAssGender").val(data.gender);
                                                   $("#"+idInput).closest(".section").find(".inputAvailable").val(1);
                                                   
                                                   $("#"+idInput).closest(".section").find(".user_to_location").attr("readonly", true);
                                                   $("#"+idInput).closest(".section").find(".inputUser").val("");
                                                   
                                                   $("#"+idInput).closest(".section").find(".inputAssName").attr("disabled", true);
                                                   $("#"+idInput).closest(".section").find(".inputAssEmail").attr("disabled", false);
                                                   $("#"+idInput).closest(".section").find(".inputAssPassword").attr("disabled", true);
                                                   $("#"+idInput).closest(".section").find(".selectAssGender option:not(:selected)").prop('disabled', true);
                                                   
                                                   
                                                    $("#"+idInput).closest(".section").find(".inputAssName").addClass("passed");
                                                    $("#"+idInput).closest(".section").find(".inputAssPassword").addClass("passed");
                                                    $("#"+idInput).closest(".section").find(".inputAssEmail").addClass("passed");
                                                      
                                                    $("#"+idInput).closest(".form-group").removeClass("has-error");
                                                    $("#"+idInput).closest(".form-group").addClass("has-success has-feedback").append('<span class="glyphicon glyphicon-ok form-control-feedback icon-status" aria-hidden="true"></span>');
                                                
                                                    $("#"+idInput).closest(".border-warning-available").removeClass("border-warning-available");
                                                }
                                            },
                                            close: {
                                                text: 'No',
                                                btnClass: 'btn-red',
                                                action: function () {
                                                    if( $("#"+idInput).hasClass("user_to_location") )
                                                    {
                                                        $("#"+idInput).closest(".section").find(".inputAvailable").val(0);
                                                    }

                                                    $("#"+idInput).closest(".form-group").removeClass("has-success");
                                                    $("#"+idInput).closest(".form-group").addClass("has-error has-feedback").append('<span class="glyphicon glyphicon-remove form-control-feedback icon-status" aria-hidden="true"></span>');

                                                    $("#"+idInput).closest(".section").find(".passed").val("");
                                                    
                                                    $("#"+idInput).closest(".section").find(".inputAssName").removeClass("passed");
                                                    $("#"+idInput).closest(".section").find(".inputAssPassword").removeClass("passed");
                                                    $("#"+idInput).closest(".section").find(".inputAssEmail").removeClass("passed");
                                                    
                                                    $("#"+idInput).closest(".section").find(".inputAssName").attr("disabled", false);
                                                    $("#"+idInput).closest(".section").find(".inputAssEmail").attr("disabled", false);
                                                    $("#"+idInput).closest(".section").find(".inputAssPassword").attr("disabled", false);
                                                    $("#"+idInput).closest(".section").find(".selectAssGender option:not(:selected)").prop('disabled', false);
                                                }
                                            }
                                        }
                                    });
                                }    
                                else
                                {
                                    $.alert({
                                        icon: 'fa fa-user-times',
                                        title: 'Info!',
                                        content: 'The user <strong>'+username+'</strong> no available',
                                        type: 'red',
                                        typeAnimated: true,
                                    });
                                }
   
                                
                            }
                        }
                        else
                        {
                            $.alert({
                                    icon: 'fa fa-user-times',
                                    title: 'Info!',
                                    content: 'The user no is valid',
                                    type: 'red',
                                    typeAnimated: true,
                                });
                        }
                        
                    }
                });
            }
            
            
            
            function setRepresenterAsDoctor()
            {
                if( $("#user_representer_doctor").is(':checked') )
                {
                   
                   
                   if( $("#nameone").size() == 0 )
                   {
                       cloneSection("noIncrement");
                   }
                   
                   useDateRepresenterAsDoctor("");
                   
                   $("#typeUser option[value='3']").remove();
                   //$("#typeUser option").find("").remove("<option></option>");
                   
                }
                else
                {
                    $("#nameone, #nametwo, #namethree, #lastnameone, #lastnametwo, #email, #username, #password_user,#password_user_again,  #availbleUser").val("");
                    $("#nameone, #nametwo, #namethree, #lastnameone, #lastnametwo").attr("readonly", false);
                    $("#password_user").attr("readonly", false);
                    $("#password_user_again").attr("readonly", false);
                    $("#email").attr("readonly", false);
                    $("#username").attr("readonly", false);
                    $("#gender").attr("readonly", false);
                    $('#gender option').prop('disabled', false);
                    //$("#")
                }
            }
            
            
            function sendFormRepresenter(users){

                
                //console.log(users);
                var location = $("#appbundle_cliente_cliTipCli");
                var fiscal_name = $("#appbundle_cliente_cliNombreFiscal");
                var municipality = $("#appbundle_cliente_cliMun");
                var address = $("#appbundle_cliente_cliDireccion");
                var locationNit = $("#appbundle_cliente_cliNit");
                var phone_one = $("#appbundle_cliente_cliTelefono1");
                var phone_two = $("#appbundle_cliente_cliTelefono2");
                var specialities = $("#appbundle_cliente_idEspecialidad");
                
                var lat = $("#appbundle_cliente_cliUbicacionLat");
                var lon = $("#appbundle_cliente_cliUbicacionLon");
                var comercialName = $("#appbundle_cliente_cliNombre");
                
                var birth_date = $("#birth_date");

                var representerNameOne = $("#nameone_representer");
                var representerNameTwo = $("#nametwo_representer");
                var representerNameThree = $("#namethree_representer");
                var representerLastNameOne = $("#lastnameone_representer");
                var representerLastNameTwo = $("#lastnametwo_representer");
                
                var representerGender = $("#gender_representer");
                var representerUser = $("#user_representer");
                var representerEmail = $("#email_representer");
                var representerPass = $("#password_representer");
                
                var referralId= $("#referralId");
                
                var locationUsers = checkAvilableUser();
                var payMethod = $('input:radio[name=optionPay]:checked').val();
                var representer_cc_number = $("#cc-number");
                var representer_cc_exp = $("#cc-exp");
                var representer_cc_cvc = $("#cc-cvc");
                var representer_cc_brand = $(".cc-brand");
             
                //console.log(locationUsers);
                //return false;
                $("#holder_loading").show();
                $.ajax({
                        type: "post",
                        url: "{{ path('cliente_valid_form') }}",
                        data: {
                            id: {{ id }},
                            location: location.val(),
                            fiscal_name: fiscal_name.val(),
                            comercial_name: comercialName.val(),
                            lat: lat.val(),
                            lon: lon.val(),
                            municipality: municipality.val(),
                            address: address.val(),
                            locationNit: locationNit.val(),
                            phone_one: phone_one.val(),
                            phone_two: phone_two.val(),
                            specialities: specialities.val(),
                            representerNameOne: representerNameOne.val(),
                            representerNameTwo: representerNameTwo.val(),
                            representerNameThree: representerNameThree.val(),
                            representerLastNameOne: representerLastNameOne.val(),
                            representerLastNameTwo: representerLastNameTwo.val(),
                            representerGender: representerGender.val(),
                            representerUser: representerUser.val(),
                            representerEmail: representerEmail.val(),
                            representerPass: representerPass.val(),
                            representerBirthDate: birth_date.val(),
                            locationUsers: locationUsers,
                            payMethod: payMethod,
                            representer_cc_number: representer_cc_number.val(),
                            representer_cc_exp: representer_cc_exp.val(),
                            representer_cc_cvc: representer_cc_cvc.val(),
                            representer_cc_brand: representer_cc_brand.text(),
                            referralId: referralId.val()
                        },
                        error: function (data) {
                            $("#holder_loading").hide();
                            $.confirm({
                                icon: 'fa fa-remove',
                                title: 'Error!',
                                content: 'An error occurred while trying to send the request',
                                type: 'red',
                                typeAnimated: true,
                                buttons: {
                                    tryAgain: {
                                        text: 'Try again',
                                        btnClass: 'btn-red',
                                        action: function () {
                                            sendFormRepresenter();
                                        }
                                    },
                                    close: function () {
                                            }
                                        }
                                    });
                        },
                        success: function (data) {
                            if( data == "1" )
                            {
                               
                               window.location.reload();
                               //$("#holder_loading").hide();
                            }
                            else
                            {
                                $("#holder_loading").hide();
                                $.alert({
                                    icon: 'glyphicon glyphicon-remove-circle',
                                    title: 'Info!',
                                    content: 'An error occurred while trying to create the record',
                                    type: 'red',
                                    typeAnimated: true,
                                 });
                            }
                            
                        }
                });
                
            }
            
            
           $("body").on("change",".typeUser", function(){
                var opt = $(this).val();
                if(opt == 3)
                {
                    $(this).closest(".section").find(".publicityWeb").attr("checked",false);
                    $(this).closest(".section").find(".publicityWeb").closest("div").hide();
                }
                else
                {
                    $(this).closest(".section").find(".publicityWeb").closest("div").show();
                    $(this).closest(".section").find(".publicityWeb").attr("checked",true);
                }    
           });
            
            //$(".ui-datepicker-year").select2();
             $.datepicker.regional['es'] = {
                closeText: 'Cerrar',
                prevText: '< Ant',
                nextText: 'Sig >',
                currentText: 'Hoy',
                monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
                monthNamesShort: ['Ene','Feb','Mar','Abr', 'May','Jun','Jul','Ago','Sep', 'Oct','Nov','Dic'],
                dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
                dayNamesShort: ['Dom','Lun','Mar','Mié','Juv','Vie','Sáb'],
                dayNamesMin: ['Do','Lu','Ma','Mi','Ju','Vi','Sá'],
                weekHeader: 'Sm',
                dateFormat: 'yy-mm-dd',
                firstDay: 1,
                isRTL: false,
                showMonthAfterYear: false,
                yearSuffix: ''
            };
            $.datepicker.setDefaults($.datepicker.regional['es']);
            var start = new Date();
            start.setFullYear(start.getFullYear() - 75);
            var end = new Date();
            end.setFullYear(end.getFullYear() - 18);
            /*
            $('#birth_date').datepicker({
                changeMonth: true,
                changeYear: true,
                minDate: start,
                maxDate: end,
                yearRange: start.getFullYear() + ':' + end.getFullYear()
            });
            */
            
            $( "#birth_date" ).datepicker({
                changeMonth: true,
                changeYear: true,
                minDate: start,
                //maxDate: end,
                //yearRange: '1945:'+(new Date).getFullYear()
                 yearRange: start.getFullYear() + ':' + end.getFullYear()
                 
            });
            /*
            $.datepicker.setDefaults($.datepicker.regional['es']);
            $( "#birth_date" ).datepicker({
                changeMonth: true,
                changeYear: true,
                yearRange: '1945:'+(new Date).getFullYear()
            });
            */
            
            $("ul[role='tablist'] li").each(function(){
                $(this).addClass("done");
                $(this).removeClass("disabled");
            });
            
            $('[data-toggle="tooltip"]').tooltip();
            //$("body").find(".ui-datepicker-year").select2();
            
             //=====================================================
            //Google maps
            //=====================================================
            var map;
            var markers = [];
            if( $("#dvMapx").size() == 1 )
            {
                var markers = [];
                var uniqueId = 1;
                var lat = "13.684978";
                var lon = "-89.263635";
                window.onload = function () {
                   //var lat = 13.684978;
                   // var lon = -89.263635;
                    if( $.trim($("#appbundle_cliente_cliUbicacionLat").val() ) != "" && $("#appbundle_cliente_cliUbicacionLat").val() != 0 )
                    {
                        lat = $("#appbundle_cliente_cliUbicacionLat").val();
                    }
                        
                    if( $.trim($("#appbundle_cliente_cliUbicacionLon").val() ) != "" && $("#appbundle_cliente_cliUbicacionLon").val() !=0 )
                    {
                        lon = $("#appbundle_cliente_cliUbicacionLon").val();
                        
                    }
                    var mapOptions = {
                        center: new google.maps.LatLng(lat, lon),
                        zoom: 11,
                        mapTypeId: google.maps.MapTypeId.ROADMAP,
                        draggable: true,
                    };
                     map = new google.maps.Map(document.getElementById("dvMap"), mapOptions);

                    //Attach click event handler to the map.
                    google.maps.event.addListener(map, 'click', function (e) {

                        //Determine the location where the user has clicked.
                        var location = e.latLng;

                        //Create a marker and placed it on the map.
                        var marker = new google.maps.Marker({
                            position: location,
                            map: map,
                            draggable: true,
                        });

                        //Set unique id
                        marker.id = uniqueId;
                        uniqueId++;

                        //Attach click event handler to the marker.
                        google.maps.event.addListener(marker, "click", function (e) {
                            var content = '<div style="margin-bottom: 5px;">Latitude: ' + location.lat() + '<br />Longitude: ' + location.lng();
                            content += "</div><input type = 'button' value = 'Eliminar ubicación' onclick = '' id='btn-delete-map' class='btn btn-danger'/>";
                            var infoWindow = new google.maps.InfoWindow({
                                content: content
                            });
                            infoWindow.open(map, marker);
                            
                            
                        });
                        //console.log(location.lat()+" - "+location.lng() );
                        lat = location.lat();
                        lon = location.lng();
                        //Add marker to the array.
                        DeleteMarker();
                        markers.push(marker);
                        //markers = marker;
                    });
                };
                
                
                
                
                $("body").on("click","#btn-delete-map", function(){
                    DeleteMarker();
                });
                function DeleteMarker() {
                    //Find and remove the marker from the Array
                    for (var i = 0; i < markers.length; i++) {
                        //if (markers[i].id == id) {
                            //Remove the marker from Map                   
                            markers[i].setMap(null);

                            //Remove the marker from array.
                            markers.splice(i, 1);
                            //return;
                        //}
                    }
                    
                };
                
                $('#modalMap').on('shown.bs.modal', function () {
                    google.maps.event.trigger(map, 'resize');
                })
            }
            
            var lat = 13.794185;
            var long = -88.89652999999998;
            if( $.trim($("#appbundle_cliente_cliUbicacionLat").val() ) != "" && $("#appbundle_cliente_cliUbicacionLat").val() != 0 )
            {
                lat = $("#appbundle_cliente_cliUbicacionLat").val();
            }
                        
            if( $.trim($("#appbundle_cliente_cliUbicacionLon").val() ) != "" && $("#appbundle_cliente_cliUbicacionLon").val() !=0 )
            {
                long = $("#appbundle_cliente_cliUbicacionLon").val();
                        
            }
            var setloc = new google.maps.LatLng(lat, long);
            
            $('#modalMap').on('shown.bs.modal', function () {
 
                var latInput =  $("#appbundle_cliente_cliUbicacionLat").val();
                var lonInput =  $("#appbundle_cliente_cliUbicacionLon").val();
                if( latInput != "" )
                {
                    $("input[name=lat]").val(latInput);
                    $("#geocomplete").val("");
                }
                
                if( lonInput != "" )
                {
                    $("input[name=lng]").val(lonInput);
                    $("#geocomplete").val("");
                }    
                
                var map = $("#geocomplete").geocomplete({
                            map: ".dvMap",
                            details: "form",
                            location: setloc,
                            markerOptions: {
                              draggable: true,
                              //disableDefaultUI: false,
                            },
                            mapOptions: {
                                zoom: 11,
                                scrollwheel: false,
                                mapTypeId: "roadmap"
                            },

                });

                $("#geocomplete").bind("geocode:dragged", function(event, latLng){
                    $("input[name=lat]").val(latLng.lat());
                    $("input[name=lng]").val(latLng.lng());
                    $("#reset").show();
                });


                $("#geocomplete").geocomplete({
                    map: ".dvMap"
                  }).bind("geocode:clicked", function(event, latLng){
                        $("#lat").val(latLng.lat());
                        $("#lng").val(latLng.lng());            
                  });


                $("#reset").click(function(){
                    $("#geocomplete").geocomplete("resetMarker");
                    $("#reset").hide();
                    return false;
                });

                $("#find").click(function(){
                    $("#geocomplete").trigger("geocode");
                }).click();
            
            //var center = new google.maps.LatLng(13.794185, -88.89652999999998);
            
                
                /*
                //var map = $("#geocomplete").geocomplete("map");
                var myLatlng = {lat: -25.363, lng: 131.044};

                var map = new google.maps.Map(document.getElementById('dvMap'), {
                  zoom: 4,
                  center: myLatlng
                 });
                    */
                //google.maps.event.trigger(map, 'resize');
                //map.setCenter(setloc);
                //alert(setloc);
            });
            //==========================================================================================

            
            //var map;
            var myLatlng = {lat: lat, lng: lon};
            var geo = false;
            /*
                function initMap() {

                    map = new google.maps.Map($("#map")[0], {
                        center: myLatlng, //{lat: -34.397, lng: 150.644},
                        zoom: 8
                      });
                }
            */
            $("#find_btn").click(function (){ //user click on button
                DeleteMarker();

                if ("geolocation" in navigator){
                        navigator.geolocation.getCurrentPosition(show_location, show_error, {timeout:1000, enableHighAccuracy: true}); //position request
                    }else{
                        console.log("Browser doesn't support geolocation!");
                }
            }); 

            //Success Callback
            function show_location(position){
                
                
                
                //markers = [];

                
                infoWindow = new google.maps.InfoWindow({map: map});
                //DeleteMarker();
                var pos = {lat: position.coords.latitude, lng: position.coords.longitude};
                infoWindow.setPosition(pos);
                //infoWindow.setContent('User Location found.');
                
                
                map.setCenter(pos);
                
                var marker = new google.maps.Marker({
                    position: pos,
                    //title:"Hello World!",
                    draggable: true,
                });
                
                infoWindow.close(map, marker);
                // To add the marker to the map, call setMap();
                marker.setMap(map);
                
                infoWindow.close(map, marker);
                
                lat = position.coords.latitude;
                lon = position.coords.longitude;
                geo = true;
                
                markers.push(marker);
            }

            //Error Callback
            function show_error(error){
               switch(error.code) {
                    case error.PERMISSION_DENIED:
                        alert("Permission denied by user.");
                        break;
                    case error.POSITION_UNAVAILABLE:
                        alert("Location position unavailable.");
                        break;
                    case error.TIMEOUT:
                        //alert("Request timeout.");
                        break;
                    case error.UNKNOWN_ERROR:
                        alert("Unknown error.");
                        break;
                }
            }
            
            /*
            function setMapOnAll(map) {
                for (var i = 0; i < markers.length; i++) {
                  markers[i].setMap(map);
                }
              }
            */
            $("#btn-set-location").on("click", function(){
                    
                    //alert();
                    /*
                    if( markers.length > 0 || geo)
                    {
                        $("#appbundle_cliente_cliUbicacionLat").val(lat);
                        $("#appbundle_cliente_cliUbicacionLon").val(lon);
                        $('#modalMap').modal('hide');
                    }
                    else
                    {
                        $.alert({
                            icon: 'fa fa-map-marker',
                            title: 'Error!',
                            content: "<p class='small'>Para ubicar el establecimiento haga click dentro del mapa</p>",
                            type: 'red',
                            typeAnimated: true,
                        });
                    }
                    */
                     var lat = $("input[name=lat]").val();
                     var lon = $("input[name=lng]").val();
                     
                     $("#appbundle_cliente_cliUbicacionLat").val(lat);
                     $("#appbundle_cliente_cliUbicacionLon").val(lon);
                    
                });
            
        });
    </script>
{% endblock %}  